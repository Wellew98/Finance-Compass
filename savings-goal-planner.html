<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Your Course to Riches: Savings Goal Navigator | Financial Compass</title>
    <meta name="description" content="Plan how to reach your savings goals in South Africa. Calculate required contributions based on your target amount and timeframe, with visual projections.">

    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.css" integrity="sha512-5vJn8XQUg+xX9KdhOhHEqJH4LO8y7ILSFoGO0w0/idrbktwr/CmvSyF5vJn8XQUg+xX9KdhOhHEqJfSZYn7ar+V5CpQOJUWJBnddvjJJjP3Q==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap" rel="stylesheet">


    <style>
        /* --- Base Styles --- */
        :root {
            --primary: #0070D1; /* Blue */
            --primary-dark: #005bb1;
            --secondary: #00BC8C; /* Teal/Green */
            --secondary-dark: #009670;
            --accent: #FFC107; /* Yellow/Gold */
            --accent-dark: #e6ac00;
            --text: #333333;
            --text-light: #666666;
            --background: #FFFFFF;
            --background-alt: #F9FBFD; /* Very light blue/grey */
            --border: #E1E8ED;
            --shadow: rgba(0, 0, 0, 0.05);
            --radius: 10px;
            --error: #e74c3c;
            --success: #2ecc71;
            --warning: #ffc107;
            --info: #17a2b8;
            --chart-balance: #0070D1;
            --chart-contributions: #00BC8C;
            --chart-growth: #FFC107;
            --chart-balance-fill: rgba(0, 112, 209, 0.1);
            --highlight-blue: rgba(0, 112, 209, 0.05); /* Added for result item highlight */
            --highlight-green: rgba(0, 188, 140, 0.05); /* Added for result item highlight */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text);
            line-height: 1.6;
            background-color: var(--background);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
         body.no-scroll {
            overflow: hidden;
        }

        a {
            text-decoration: none;
            color: var(--primary);
            transition: color 0.3s;
        }

        a:hover {
            color: var(--primary-dark);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        img {
             max-width: 100%;
             height: auto;
             display: block;
        }

        /* --- Buttons --- */
        .btn {
            display: inline-block;
            padding: 12px 28px;
            background-color: var(--primary);
            color: white;
            border-radius: var(--radius);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            text-align: center;
            font-size: 1rem;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 112, 209, 0.2);
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
            box-shadow: 0 4px 12px rgba(0, 188, 140, 0.2);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }
         .btn:disabled {
             opacity: 0.6;
             cursor: not-allowed;
             transform: none;
             box-shadow: none;
         }


        /* --- Header --- */
        header {
            background-color: var(--background);
            box-shadow: 0 2px 10px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            height: 73px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text);
        }

        .logo i {
            color: var(--primary);
            margin-right: 10px;
            font-size: 1.8rem;
        }

        .logo span {
             color: var(--primary);
        }

        .nav-menu {
            display: flex;
            list-style: none;
        }

        .nav-item {
            margin-left: 28px;
        }

        .nav-link {
            color: var(--text);
            font-weight: 500;
            padding: 8px 4px;
            position: relative;
            font-size: 1rem;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after,
        .nav-link.active::after {
             width: 100%;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text);
            padding: 5px;
        }


        /* --- Calculator Section --- */
        .calculator-section {
            padding: 60px 0;
            background: linear-gradient(135deg, var(--background-alt), rgba(0, 188, 140, 0.05));
        }

        .section-title {
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-align: center;
            color: var(--primary-dark);
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-light);
            text-align: center;
            max-width: 700px;
            margin: 0 auto 3rem;
        }


        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 40px;
        }

        .calculator-form {
            background-color: var(--background);
            border-radius: var(--radius);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            padding: 30px;
            border: 1px solid var(--border);
        }
        /* Form Title inside calculator form box */
        .calculator-form-title {
            font-size: 1.8rem; /* Slightly smaller than section title */
            font-weight: 600;
            color: var(--primary); /* Primary color for this title */
            margin-bottom: 24px; /* Space below title */
            padding-bottom: 12px; /* Space for underline */
            border-bottom: 2px solid var(--secondary); /* Secondary color underline */
        }


        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
            display: flex;
            align-items: center;
        }
         .form-label .fas {
             margin-left: 6px;
             font-size: 0.9em;
             color: var(--primary);
         }


        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: border 0.3s ease, box-shadow 0.3s ease;
            background-color: var(--background-alt);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(0, 112, 209, 0.15);
            background-color: var(--background);
        }

        .form-control.invalid {
             border-color: var(--error);
             box-shadow: 0 0 0 4px rgba(231, 76, 60, 0.15);
        }

        .input-group {
            display: flex;
            align-items: center;
        }

        .input-group-addon {
            padding: 12px 16px;
            background-color: var(--border);
            border: 1px solid var(--border);
            border-right: none;
            border-radius: var(--radius) 0 0 var(--radius);
            color: var(--text);
            font-weight: 500;
        }
         .input-group-addon.suffix {
             border-radius: 0 var(--radius) var(--radius) 0;
             border-left: none;
             border-right: 1px solid var(--border);
         }

        .input-group .form-control {
            border-radius: 0 var(--radius) var(--radius) 0;
        }
         .input-group .form-control[type="number"] {
             padding-right: 12px;
         }
         .input-group .form-control + .input-group-addon.suffix {
            padding-left: 12px;
         }

        .form-message {
            display: none;
            margin-top: 6px;
            font-size: 0.9rem;
            color: var(--error);
            font-weight: 500;
        }
         .form-message.active {
             display: block;
         }

        .action-buttons {
            display: flex;
            justify-content: space-between;
            gap: 16px;
            margin-top: 30px;
        }

        .action-buttons .btn {
            flex: 1;
        }


        .calculator-results {
            background-color: var(--background);
            border-radius: var(--radius);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
            padding: 30px;
            border: 1px solid var(--border);
            position: relative;
            display: none;
        }

        .results-header {
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
        }

        .results-title {
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .results-subtitle {
            font-size: 1rem;
            color: var(--text-light);
        }

        .results-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-item {
            background-color: var(--background-alt);
            padding: 20px;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            transition: all 0.3s ease;
        }
         .result-item.highlight-primary {
             background-color: var(--highlight-blue);
             border-color: var(--primary);
         }
          .result-item.highlight-secondary {
             background-color: var(--highlight-green);
             border-color: var(--secondary);
         }


        .result-label {
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-light);
            margin-bottom: 8px;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
            word-break: break-word;
        }
         .result-item.highlight-primary .result-value {
             color: var(--primary-dark);
         }
          .result-item.highlight-secondary .result-value {
             color: var(--secondary-dark);
         }


        .result-note {
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px dashed var(--border);
            width: 100%;
        }

        .chart-container { /* Renamed from visualization-container to be more specific */
            position: relative;
            margin-top: 24px;
            height: 350px;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
         .chart-container canvas { /* Ensure canvas itself is responsive */
             max-width: 100%;
             max-height: 100%;
         }

         .chart-title { /* General title for charts/visualizations */
            text-align: center;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 1.5rem;
            font-size: 1.3rem;
        }


        /* --- FAQ Section --- */
        .faq-section {
            padding: 60px 0;
            background-color: var(--background); /* Changed from background-alt for contrast */
        }

        .accordion {
            margin-top: 40px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden; /* Important for containing collapsing items */
        }

        .accordion-item {
            border-bottom: 1px solid var(--border);
        }

        .accordion-item:last-child {
            border-bottom: none;
        }

        .accordion-header {
            background-color: var(--background); /* Lighter background for header */
            padding: 20px 24px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .accordion-header:hover {
            background-color: var(--background-alt); /* Subtle hover effect */
        }

        .accordion-title {
            font-size: 1.1rem;
            font-weight: 500;
            color: var(--text);
        }

        .accordion-icon {
            transition: transform 0.3s ease; /* Smooth icon rotation */
        }

        /* CORRECTED ACCORDION CSS */
        .accordion-content {
            padding: 0 24px; /* Horizontal padding is always there */
            max-height: 0;
            overflow: hidden;
            /* Define all transitions here for smooth open/close */
            transition: max-height 0.4s ease-in-out, padding-top 0.4s ease-in-out, padding-bottom 0.4s ease-in-out;
        }

        .accordion-item.active .accordion-header {
            background-color: var(--background-alt); /* Indicate active state */
        }
        
        .accordion-item.active .accordion-icon {
            transform: rotate(180deg);
        }

        .accordion-item.active .accordion-content {
            /* max-height will be set by JS to content.scrollHeight + "px" */
            /* The transition for max-height from the base .accordion-content class will apply */
            padding-top: 20px; /* Vertical padding when active */
            padding-bottom: 24px; /* Vertical padding when active */
        }
        /* END CORRECTED ACCORDION CSS */

        .accordion-content-inner {
            /* This inner div is still useful if you need specific styling *inside* the padded area */
            /* For this setup, direct children of .accordion-content will get the padding. */
            /* If you have complex content, you might still use .accordion-content-inner */
            /* For now, we simplify and assume direct content. */
            color: var(--text-light);
            border-top: 1px solid var(--border); /* Add border on top when open */
        }


        /* Calculator Tips */
        .tip-box {
            margin-top: 30px;
            padding: 20px;
            background-color: rgba(0, 112, 209, 0.05);
            border-left: 4px solid var(--primary);
            border-radius: 0 var(--radius) var(--radius) 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .tip-title {
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .tip-title i {
            margin-right: 10px;
            color: var(--accent);
            font-size: 1.2em;
        }

        .tip-content {
            font-size: 0.95rem;
            color: var(--text-light);
        }

        .tip-content ul {
            margin-top: 10px;
            padding-left: 25px;
        }

        .tip-content li {
            margin-bottom: 8px;
        }


        /* --- Footer --- */
        footer {
            background-color: #1e293b;
            color: rgba(255, 255, 255, 0.8);
            padding: 64px 0 32px;
            font-size: 0.95rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 48px;
            margin-bottom: 48px;
        }

        .footer-column.about .footer-logo {
             color: white;
             font-size: 1.6rem;
             margin-bottom: 16px;
             display: inline-flex;
             align-items: center;
        }
        .footer-column.about .footer-logo i {
             color: var(--primary);
             margin-right: 10px;
        }


        .footer-description {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 24px;
            line-height: 1.7;
        }

        .footer-social {
            display: flex;
            gap: 12px;
        }

        .footer-social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .footer-social-link:hover {
            background-color: var(--primary);
            transform: translateY(-3px);
        }

        .footer-heading {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 24px;
            color: white;
        }

        .footer-links {
            list-style: none;
            padding: 0;
        }

        .footer-link {
            margin-bottom: 12px;
        }

        .footer-link a {
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
        }

        .footer-link a:hover {
            color: var(--secondary);
            padding-left: 8px;
        }


        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            padding-top: 32px;
            margin-top: 16px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.875rem;
        }


        /* --- Responsive Styles --- */
        @media (max-width: 992px) {
            .nav-menu {
                position: fixed;
                top: 73px;
                left: -100%;
                flex-direction: column;
                background-color: var(--background);
                width: 100%;
                height: calc(100vh - 73px);
                transition: left 0.3s ease-in-out;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
                padding: 20px 0;
                overflow-y: auto;
                z-index: 999;
             }

             .nav-menu.active {
                left: 0;
             }

             .nav-item {
                margin: 0;
                width: 100%;
             }
             .nav-link {
                 display: block;
                 padding: 16px 30px;
                 text-align: left;
                 border-bottom: 1px solid var(--border);
                 font-size: 1.1rem;
             }
             .nav-link:hover {
                 background-color: var(--background-alt);
             }
              .nav-link::after {
                 display: none;
             }
             .nav-item:last-child .nav-link {
                 border-bottom: none;
             }

             .mobile-menu-btn {
                 display: block;
             }

             .calculator-container {
                grid-template-columns: 1fr;
             }
             .calculator-results {
                 margin-top: 30px;
             }
        }

        @media (max-width: 768px) {
            /* .section was too generic, apply padding directly or use more specific class */
            .calculator-section, .faq-section {
                padding: 40px 0; /* Reduced padding for smaller screens */
            }
            .section-title {
                font-size: 1.8rem; /* Adjusted title size */
            }
            .section-subtitle {
                 font-size: 1rem; /* Adjusted subtitle size */
            }
            .results-summary {
                grid-template-columns: 1fr;
            }
            .result-value {
                 font-size: 1.8rem;
            }
             .chart-title {
                 font-size: 1.1rem;
             }
             .calculator-form-title {
                font-size: 1.5rem;
             }

            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            .footer-column {
                 display: flex;
                 flex-direction: column;
                 align-items: center;
            }
             .footer-column.about .footer-logo {
                 justify-content: center;
             }
            .footer-social {
                 justify-content: center;
            }
            .footer-links {
                 text-align: center;
            }
        }

         @media (max-width: 576px) {
             .section-title {
                 font-size: 1.6rem;
             }
             .section-subtitle {
                 font-size: 0.9rem;
             }
             .result-value {
                 font-size: 1.6rem;
             }
             .header-container {
                 padding: 12px 0;
                 height: 65px;
             }
             .nav-menu {
                 top: 65px;
                 height: calc(100vh - 65px);
             }
             .logo {
                 font-size: 1.4rem;
             }
             .logo i {
                 font-size: 1.6rem;
             }
             .action-buttons {
                 flex-direction: column;
                 gap: 12px;
             }
             .btn { /* Make buttons take more width on small screens */
                 width: 100%; /* Full width within their container */
                 padding: 14px 20px;
             }
              .form-group {
                  margin-bottom: 20px;
              }
               .form-control {
                   padding: 10px 14px;
                   font-size: 0.95rem;
               }
               .input-group-addon {
                   padding: 10px 14px;
               }
                .accordion-header {
                    padding: 16px 20px;
                }
                .accordion-title {
                    font-size: 1rem;
                }
                .accordion-content-inner { /* Adjust padding if still used */
                     padding: 16px 0 20px 0;
                }
                .tip-box {
                     padding: 16px;
                }
                .tip-title {
                     font-size: 1rem;
                }
                .tip-title i {
                     font-size: 1.1em;
                }
                .calculator-form-title {
                    font-size: 1.3rem;
                }
                .results-title {
                    font-size: 1.3rem;
                }
         }
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <a href="/" class="logo"> <i class="fas fa-compass"></i> Financial<span>Compass</span>
            </a>

            <nav>
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Open Menu" aria-expanded="false" aria-controls="navMenu">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="nav-menu" id="navMenu">
                    <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="/#tools" class="nav-link active">Financial Tools</a></li>
                    <li class="nav-item"><a href="/#about" class="nav-link">Why Us</a></li>
                    <li class="nav-item"><a href="/#updates" class="nav-link">Updates</a></li>
                    </ul>
            </nav>
        </div>
    </header>

    <main>
        <section class="calculator-section">
            <div class="container">
                <h1 class="section-title">Chart Your Course to Riches: Savings Goal Navigator</h1>
                <p class="section-subtitle">Embark on your financial safari! This navigator helps you map out the contributions needed to reach your treasure chest.</p>

                <div class="calculator-container">
                    <div class="calculator-form">
                        <h2 class="calculator-form-title">Plot Your Expedition Details</h2>
                        <form id="savingsGoalForm">
                            <div class="form-group">
                                <label for="goalAmount" class="form-label">Your Treasure Target (Goal Amount)<i class="fas fa-info-circle" title="How much treasure are you aiming to gather?"></i></label>
                                <div class="input-group">
                                    <span class="input-group-addon">R</span>
                                    <input type="number" id="goalAmount" class="form-control" value="100000" min="1000" step="100" required>
                                </div>
                                <span class="form-message" id="goalAmountError">Please enter a valid positive savings goal amount.</span>
                            </div>

                            <div class="form-group">
                                <label for="currentSavings" class="form-label">Your Starting Hoard (Current Savings)<i class="fas fa-info-circle" title="How much have you already stashed away?"></i></label>
                                <div class="input-group">
                                    <span class="input-group-addon">R</span>
                                    <input type="number" id="currentSavings" class="form-control" value="10000" min="0" step="100" required>
                                </div>
                                <span class="form-message" id="currentSavingsError">Please enter a valid current savings amount (cannot exceed your goal).</span>
                            </div>

                             <div class="form-group">
                                 <label for="timeframe" class="form-label">Expedition Length (Timeframe)<i class="fas fa-info-circle" title="How long is your journey to the treasure?"></i></label>
                                 <div class="input-group">
                                     <input type="number" id="timeframe" class="form-control" value="5" min="1" required>
                                     <span class="input-group-addon suffix" id="timeframeUnit">Years</span>
                                 </div>
                                  <span class="form-message" id="timeframeError">Please enter a valid positive timeframe.</span>
                             </div>

                             <div class="form-group">
                                 <label for="timeframeType" class="form-label">Timeframe Unit</label>
                                 <select id="timeframeType" class="form-control">
                                     <option value="years">Years</option>
                                     <option value="months">Months</option>
                                 </select>
                             </div>


                             <div class="form-group">
                                 <label for="annualGrowthRate" class="form-label">Jungle Growth (Expected Annual Investment Growth)<i class="fas fa-info-circle" title="How fast do you expect your savings to grow each year, like a mighty Baobab? (e.g., 6 for 6%)"></i></label>
                                  <div class="input-group">
                                     <input type="number" id="annualGrowthRate" class="form-control" value="6" min="0" max="30" step="0.1" required> <span class="input-group-addon suffix">% p.a.</span>
                                  </div>
                                   <span class="form-message" id="annualGrowthRateError">Please enter a valid annual growth rate (e.g., 0-30%).</span>
                             </div>


                            <div class="action-buttons">
                                <button type="button" id="savingsCalculateBtn" class="btn btn-primary"><i class="fas fa-map-signs"></i> Chart My Adventure!</button>
                                <button type="reset" id="savingsResetBtn" class="btn btn-outline"><i class="fas fa-redo"></i> Reset Map</button>
                            </div>
                        </form>
                    </div>

                    <div class="calculator-results" id="savingsResultsSection">
                        <div class="results-header">
                            <h3 class="results-title">Your Expedition Blueprint Unveiled!</h3>
                            <p class="results-subtitle">Here’s your map to turning that savings goal into a reality.</p>
                        </div>

                        <div class="results-summary">
                            <div class="result-item highlight-primary"> <span class="result-label">Treasure Still To Find (Amount Needed):</span>
                                <span class="result-value" id="amountToSave">R0.00</span>
                                <div class="result-note">Excluding your starting hoard</div>
                            </div>
                            <div class="result-item highlight-secondary"> <span class="result-label" id="requiredContributionLabel">Required Monthly Stash:</span>
                               <span class="result-value" id="requiredContribution">R0.00</span>
                               <div class="result-note">Based on your expedition length & jungle growth</div>
                           </div>
                            <div class="result-item">
                                <span class="result-label">Projected Final Treasure Chest:</span>
                                <span class="result-value" id="projectedFinalSavings">R0.00</span>
                                <div class="result-note">Your contributions + estimated jungle growth</div>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Total Stashed by You:</span>
                                <span class="result-value" id="totalContributed">R0.00</span>
                                <div class="result-note">Sum of your regular stashes + starting hoard</div>
                            </div>
                             <div class="result-item">
                                <span class="result-label">Total Estimated Jungle Growth:</span>
                                <span class="result-value" id="totalGrowthEarned">R0.00</span>
                                <div class="result-note">The magic of compounding in the financial jungle!</div>
                            </div>
                        </div>

                        <div class="chart-container"> <h4 class="chart-title">Your Savings Safari Over Time</h4>
                            <canvas id="savingsGrowthChart"></canvas>
                        </div>
                    </div>
                </div>

                 <div class="tip-box">
                        <h4 class="tip-title"><i class="fas fa-lightbulb"></i> Mzansi Smart Savings Secrets</h4>
                        <div class="tip-content">
                            <p>Use these local strategies to make your treasure hunt easier:</p>
                            <ul>
                                <li><strong>Set SMART Goals:</strong> Make your goals Specific, Measurable, Achievable, Relevant, and Time-bound. A clear map leads to treasure!</li>
                                <li><strong>Automate Your Stash:</strong> Set up automatic transfers to your savings "cave" each payday. What you don't see, you won't miss!</li>
                                <li><strong>Trim the Wild Growth (Expenses):</strong> Find areas in your budget to cut back. Even small savings are like finding extra berries on the trail – they add up!</li>
                                <li><strong>Boost Your Foraging (Income):</strong> Explore ways to earn extra, like a side hustle (a "weekend gig") or selling unused items.</li>
                                <li><strong>Check Your Compass Regularly:</strong> Track your progress. If you're ahead, awesome! If behind, adjust your path or how much you stash.</li>
                                <li><strong>Choose Your Watering Hole Wisely:</strong> Research savings accounts or investments (like Tax-Free Savings Accounts in SA) that offer the best growth for your journey and comfort with risk.</li>
                            </ul>
                        </div>
                    </div>

            </div>
        </section>

         <section class="faq-section">
            <div class="container">
                <h2 class="section-title">Savings Safari FAQs</h2>
                <p class="section-subtitle">Your guide to common questions on the trail to your savings treasure.</p>

                <div class="accordion" id="savingsFAQ">
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <h3 class="accordion-title">How much treasure should I bury (save) each month?</h3>
                            <i class="accordion-icon fas fa-chevron-down"></i>
                        </div>
                        <div class="accordion-content">
                            <div class="accordion-content-inner">
                                <p>There's no single map for everyone! It depends on your income, expenses, debts, and how big & urgent your treasure hunt is. The 50/30/20 rule (50% needs, 30% wants, 20% savings/debt) is a general guide, but this navigator gives you a specific monthly target for *your* treasure.</p>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <div class="accordion-header">
                            <h3 class="accordion-title">Where's the safest cave for my savings in South Africa?</h3>
                            <i class="accordion-icon fas fa-chevron-down"></i>
                        </div>
                        <div class="accordion-content">
                            <div class="accordion-content-inner">
                                <p>For short-term hunts (treasure you need in <1-3 years), look at high-yield savings or money market accounts from local banks – easy access, low risk. For longer expeditions, explore Tax-Free Savings Accounts (TFSAs) or investments like unit trusts. They can offer more "jungle growth" but might have more twists and turns (risk).</p>
                            </div>
                        </div>
                    </div>
                     <div class="accordion-item">
                        <div class="accordion-header">
                            <h3 class="accordion-title">How does 'jungle growth' (growth rate) affect my hunt?</h3>
                            <i class="accordion-icon fas fa-chevron-down"></i>
                        </div>
                        <div class="accordion-content">
                            <div class="accordion-content-inner">
                                <p>Annual growth rate is like magic fertilizer for your savings due to compounding! Higher growth means you might need to stash less yourself, as your existing treasure and its growth also start earning. Be realistic – faster growth often means a bumpier trail (higher risk).</p>
                            </div>
                        </div>
                    </div>
                     <div class="accordion-item">
                        <div class="accordion-header">
                            <h3 class="accordion-title">What if I can't stash the required monthly amount?</h3>
                            <i class="accordion-icon fas fa-chevron-down"></i>
                        </div>
                        <div class="accordion-content">
                            <div class="accordion-content-inner">
                                <p>Don't get lost in the bush! If the calculated stash is too high: aim for a smaller treasure chest, extend your expedition, or find ways to boost your foraging (income) or trim wild growth (expenses). Consistency is key, even if the stash is smaller than first mapped out.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column about">
                    <a href="/" class="footer-logo">
                        <i class="fas fa-compass"></i> Financial<span>Compass</span>
                    </a>
                    <p class="footer-description">Your free guide to navigating South African personal finance. Empowering you with clear, accurate tools and insights.</p>
                    <div class="footer-social">
                        <a href="https://www.facebook.com/profile.php?id=61575624285316" class="footer-social-link" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://x.com/FinCompassSA" class="footer-social-link" aria-label="X (formerly Twitter)"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.linkedin.com/company/107288558" class="footer-social-link" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>

                <div class="footer-column links">
                    <h3 class="footer-heading">Quick Links</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="/">Home</a></li>
                        <li class="footer-link"><a href="/#tools">Financial Tools</a></li>
                        <li class="footer-link"><a href="/#about">Why Us</a></li>
                        <li class="footer-link"><a href="/#updates">Updates</a></li>
                         <li class="footer-link"><a href="terms-privacy.html">Terms & Privacy</a></li>
                        </ul>
                </div>

                 <div class="footer-column calculators">
                    <h3 class="footer-heading">Calculators</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="sars-tax-calculator.html">SARS Tax Calculator</a></li>
                        <li class="footer-link"><a href="budget-planner.html">Budget Planner</a></li>
                        <li class="footer-link"><a href="loan-calculators.html">Loan Calculators</a></li>
                        <li class="footer-link"><a href="vat-calculator.html">VAT Calculator</a></li>
                        <li class="footer-link"><a href="retirement-calculator.html">Retirement Calculator</a></li>
                        <li class="footer-link"><a href="savings-goal-planner.html">Savings Goal Planner</a></li>
                    </ul>
                </div>

                 <div class="footer-column contact">
                    <h3 class="footer-heading">Disclaimer</h3>
                     <p class="footer-description" style="font-size: 0.85rem; color: rgba(255,255,255,0.5);">
                        Financial Compass provides tools for estimation purposes only. Information should not be considered financial advice. Always consult a qualified professional for financial decisions.
                    </p>
                    </div>

            </div>
            <div class="footer-bottom">
                &copy; <span id="currentYear"></span> Financial Compass. Built for South Africans. All Rights Reserved.
            </div>
        </div>
    </footer>


    <script>
        // --- Mobile Menu Toggle ---
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const navMenu = document.getElementById('navMenu');
        const body = document.body;

        if (mobileMenuBtn && navMenu) {
            mobileMenuBtn.addEventListener('click', () => {
                const isExpanded = navMenu.classList.toggle('active');
                mobileMenuBtn.setAttribute('aria-expanded', isExpanded);
                const icon = mobileMenuBtn.querySelector('i');
                if (icon) {
                    icon.className = isExpanded ? 'fas fa-times' : 'fas fa-bars';
                }
                body.classList.toggle('no-scroll', isExpanded);
            });

            // Close menu when a link within the menu is clicked (for SPA-like behavior or anchor links)
            navMenu.querySelectorAll('a').forEach(link => { // Changed to all 'a' tags
                link.addEventListener('click', (e) => {
                    // Only close if it's a link that navigates away or to an anchor on the same page
                    if (navMenu.classList.contains('active')) {
                        navMenu.classList.remove('active');
                        mobileMenuBtn.setAttribute('aria-expanded', 'false');
                        const icon = mobileMenuBtn.querySelector('i');
                        if (icon) {
                             icon.className = 'fas fa-bars';
                         }
                         body.classList.remove('no-scroll');
                    }
                });
            });

             // Close menu when clicking outside
             document.addEventListener('click', (e) => {
                 if (navMenu.classList.contains('active') && !navMenu.contains(e.target) && !mobileMenuBtn.contains(e.target)) {
                     navMenu.classList.remove('active');
                     mobileMenuBtn.setAttribute('aria-expanded', 'false');
                     const icon = mobileMenuBtn.querySelector('i');
                     if (icon) {
                         icon.className = 'fas fa-bars';
                     }
                     body.classList.remove('no-scroll');
                 }
             });
        }

        // --- Footer Year ---
        const currentYearSpan = document.getElementById('currentYear');
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        }

        // --- Accordion Functionality (Corrected & Refined) ---
        const accordionItems = document.querySelectorAll('.accordion-item');
        accordionItems.forEach(item => {
            const header = item.querySelector('.accordion-header');
            const content = item.querySelector('.accordion-content');

            if (header && content) { // Ensure elements exist
                header.addEventListener('click', () => {
                    const isActive = item.classList.contains('active');

                    // Close all other accordion items before opening/closing the current one
                    accordionItems.forEach(otherItem => {
                        if (otherItem !== item) { // Don't close the item we are about to toggle
                            otherItem.classList.remove('active');
                            const otherContent = otherItem.querySelector('.accordion-content');
                            if (otherContent) {
                                otherContent.style.maxHeight = null; // Collapse by resetting maxHeight
                            }
                        }
                    });

                    // Toggle the clicked item
                    if (!isActive) {
                        item.classList.add('active');
                        // Set max-height after a short delay.
                        // This allows CSS to apply 'active' class styles that might affect scrollHeight (like padding).
                        // The scrollHeight will then be the correct height of the content including its padding.
                        setTimeout(() => {
                            content.style.maxHeight = content.scrollHeight + "px";
                        }, 10); // A small delay like 10ms is usually enough.
                    } else {
                        // If already active, just remove the class and reset maxHeight to collapse it.
                        // The CSS transition on .accordion-content will handle the smooth collapse.
                        content.style.maxHeight = content.scrollHeight + "px"; // Set to current height before collapsing
                        requestAnimationFrame(() => { // Ensure the above is processed
                            item.classList.remove('active');
                            content.style.maxHeight = null; 
                        });
                    }
                });
            } else {
                console.warn('Accordion item missing header or content:', item);
            }
        });


        // --- Helper Functions ---
        function formatCurrency(amount) {
            const numericAmount = parseFloat(amount);
            if (isNaN(numericAmount)) {
                return 'R0.00'; // Default for invalid numbers
            }
            return 'R' + numericAmount.toLocaleString('en-ZA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }


        // --- Get CSS Chart Colors ---
        const rootStyles = getComputedStyle(document.documentElement);
        const chartBalanceColor = rootStyles.getPropertyValue('--chart-balance').trim() || '#0070D1';
        const chartContributionsColor = rootStyles.getPropertyValue('--chart-contributions').trim() || '#00BC8C';
        // const chartGrowthColor = rootStyles.getPropertyValue('--chart-growth').trim() || '#FFC107'; // Not directly used in current chart datasets
        const chartBalanceFillColor = rootStyles.getPropertyValue('--chart-balance-fill').trim() || 'rgba(0, 112, 209, 0.1)';


        // --- Savings Goal Planner Logic ---
        const savingsGoalForm = document.getElementById('savingsGoalForm');
        const goalAmountInput = document.getElementById('goalAmount');
        const currentSavingsInput = document.getElementById('currentSavings');
        const timeframeInput = document.getElementById('timeframe');
        const timeframeTypeSelect = document.getElementById('timeframeType');
        const timeframeUnitSpan = document.getElementById('timeframeUnit');
        const annualGrowthRateInput = document.getElementById('annualGrowthRate');
        const savingsCalculateBtn = document.getElementById('savingsCalculateBtn');
        const savingsResetBtn = document.getElementById('savingsResetBtn');
        const savingsResultsSection = document.getElementById('savingsResultsSection');

        const amountToSaveEl = document.getElementById('amountToSave');
        const requiredContributionLabelEl = document.getElementById('requiredContributionLabel');
        const requiredContributionEl = document.getElementById('requiredContribution');
        const projectedFinalSavingsEl = document.getElementById('projectedFinalSavings');
        const totalContributedEl = document.getElementById('totalContributed');
        const totalGrowthEarnedEl = document.getElementById('totalGrowthEarned');
        const savingsGrowthCanvas = document.getElementById('savingsGrowthChart');

        const goalAmountError = document.getElementById('goalAmountError');
        const currentSavingsError = document.getElementById('currentSavingsError');
        const timeframeError = document.getElementById('timeframeError');
        const annualGrowthRateError = document.getElementById('annualGrowthRateError');

        let savingsGrowthChart = null;


        if (timeframeTypeSelect && timeframeUnitSpan && requiredContributionLabelEl && timeframeInput) {
            timeframeTypeSelect.addEventListener('change', function() {
                const selectedValue = timeframeTypeSelect.value;
                timeframeUnitSpan.textContent = selectedValue === 'years' ? 'Years' : 'Months';
                requiredContributionLabelEl.textContent = selectedValue === 'years' ? 'Required Annual Stash:' : 'Required Monthly Stash:';

                 if (selectedValue === 'years') {
                     timeframeInput.min = 1;
                     timeframeInput.max = 70; // Max years
                     if (parseInt(timeframeInput.value) > 70) timeframeInput.value = 70;
                     if (parseInt(timeframeInput.value) < 1 && timeframeInput.value !== "") timeframeInput.value = 1;
                     timeframeInput.step = 1;
                 } else {
                     timeframeInput.min = 1;
                     timeframeInput.max = 840; // Max months (70 years * 12)
                      if (parseInt(timeframeInput.value) > 840) timeframeInput.value = 840;
                      if (parseInt(timeframeInput.value) < 1 && timeframeInput.value !== "") timeframeInput.value = 1;
                      timeframeInput.step = 1;
                 }
            });
        }


        function calculateSavingsGoal() {
             // Use a timeout to allow the button click animation to start and UI to update
             setTimeout(() => {
                if (!savingsCalculateBtn || !goalAmountInput || !currentSavingsInput || !timeframeInput || !timeframeTypeSelect || !annualGrowthRateInput || !savingsResultsSection) {
                     console.error("One or more required calculator elements not found.");
                     if(savingsCalculateBtn) {
                        savingsCalculateBtn.innerHTML = '<i class="fas fa-map-signs"></i> Chart My Adventure!';
                        savingsCalculateBtn.disabled = false;
                     }
                     return;
                }

                savingsCalculateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Charting...';
                savingsCalculateBtn.disabled = true;

                document.querySelectorAll('.form-message').forEach(msg => {
                    msg.textContent = '';
                    msg.classList.remove('active');
                });
                 document.querySelectorAll('.form-control').forEach(input => {
                     input.classList.remove('invalid');
                 });

                const goalAmount = parseFloat(goalAmountInput.value);
                let currentSavings = parseFloat(currentSavingsInput.value) || 0;
                const timeframe = parseInt(timeframeInput.value);
                const timeframeType = timeframeTypeSelect.value;
                const annualGrowthRate = parseFloat(annualGrowthRateInput.value) / 100;

                let isValid = true;
                if (isNaN(goalAmount) || goalAmount <= 0) {
                    if(goalAmountError) {
                        goalAmountError.textContent = 'Please enter a valid positive savings goal amount.';
                        goalAmountError.classList.add('active');
                    }
                    if(goalAmountInput) goalAmountInput.classList.add('invalid');
                    isValid = false;
                }
                 if (isNaN(currentSavings) || currentSavings < 0) {
                      if(currentSavingsError) {
                          currentSavingsError.textContent = 'Please enter a valid current savings amount (cannot be negative).';
                          currentSavingsError.classList.add('active');
                      }
                      if(currentSavingsInput) currentSavingsInput.classList.add('invalid');
                      isValid = false;
                 }
                if (isNaN(timeframe) || timeframe <= 0) {
                     if(timeframeError) {
                         timeframeError.textContent = 'Please enter a valid positive timeframe.';
                         timeframeError.classList.add('active');
                     }
                     if(timeframeInput) timeframeInput.classList.add('invalid');
                     isValid = false;
                 }
                 if (isNaN(annualGrowthRate) || annualGrowthRate < 0 || annualGrowthRate > 0.30) { // Max 30%
                      if(annualGrowthRateError) {
                          annualGrowthRateError.textContent = 'Please enter a valid annual growth rate (0-30%).';
                          annualGrowthRateError.classList.add('active');
                      }
                      if(annualGrowthRateInput) annualGrowthRateInput.classList.add('invalid');
                      isValid = false;
                 }

                 if (isValid && currentSavings >= goalAmount) {
                      if(currentSavingsError) {
                          currentSavingsError.textContent = 'Your current hoard already meets or exceeds your treasure target!';
                          currentSavingsError.classList.add('active');
                      }
                       if(currentSavingsInput) currentSavingsInput.classList.add('invalid');
                       // isValid = false; // Allow calculation to show 0 contribution
                 }


                if (!isValid) {
                    clearSavingsGoalResults();
                     savingsCalculateBtn.innerHTML = '<i class="fas fa-map-signs"></i> Chart My Adventure!';
                     savingsCalculateBtn.disabled = false;
                    return;
                }

                const numberOfMonths = timeframeType === 'years' ? timeframe * 12 : timeframe;
                const monthlyGrowthRate = annualGrowthRate / 12;
                const amountNeededFromNow = Math.max(0, goalAmount - currentSavings); // Cannot be negative

                let requiredMonthlyContribution = 0;

                 if (amountNeededFromNow <= 0) { // Already reached goal
                     requiredMonthlyContribution = 0;
                 } else if (monthlyGrowthRate <= 0 || numberOfMonths <= 0) {
                     requiredMonthlyContribution = numberOfMonths > 0 ? amountNeededFromNow / numberOfMonths : amountNeededFromNow;
                 } else {
                      const fvOfCurrentSavings = currentSavings * Math.pow(1 + monthlyGrowthRate, numberOfMonths);
                      const futureValueFactor = (Math.pow(1 + monthlyGrowthRate, numberOfMonths) - 1) / monthlyGrowthRate;

                      if (futureValueFactor > 0) {
                          requiredMonthlyContribution = (goalAmount - fvOfCurrentSavings) / futureValueFactor;
                      } else {
                           requiredMonthlyContribution = Math.max(0, (goalAmount - fvOfCurrentSavings) / (numberOfMonths || 1) ); // Fallback
                      }
                 }

                requiredMonthlyContribution = Math.max(0, requiredMonthlyContribution);


                let simulatedBalance = currentSavings;
                let simulatedTotalContributedByAdding = 0; // Only new contributions

                 const periodLabels = ['Start'];
                 const balanceData = [currentSavings];
                 const contributionsData = [currentSavings]; // Cumulative: initial + added

                 const simulationStep = numberOfMonths <= 36 ? 1 : (numberOfMonths <= 120 ? 6 : 12) ; // Monthly up to 3 yrs, 6-monthly up to 10 yrs, then yearly

                for (let month = 1; month <= numberOfMonths; month++) {
                     simulatedBalance += requiredMonthlyContribution;
                     simulatedTotalContributedByAdding += requiredMonthlyContribution;
                     simulatedBalance *= (1 + monthlyGrowthRate);

                     if (month % simulationStep === 0 || month === numberOfMonths) {
                          let label;
                          if (simulationStep === 1) {
                               label = `Month ${month}`;
                          } else if (simulationStep === 6 && month % 6 === 0) {
                               label = `Mth ${month}`; // Shorter for more points
                          } else if (simulationStep === 12 && month % 12 === 0) {
                               label = `Year ${month / 12}`;
                          } else if (month === numberOfMonths) { // Ensure final point is labeled correctly
                               label = timeframeType === 'years' ? `Year ${timeframe}` : `Month ${timeframe}`;
                          } else {
                               continue; // Skip if not a designated step, unless it's the final month
                          }
                          periodLabels.push(label);
                          balanceData.push(Math.min(simulatedBalance, goalAmount * 1.05)); // Cap chart slightly above goal
                          contributionsData.push(currentSavings + simulatedTotalContributedByAdding);
                     }
                }
                // Ensure the final balance point in the chart data is the goal amount for visual consistency
                if (balanceData.length > 1) {
                    balanceData[balanceData.length - 1] = goalAmount;
                }


                const amountNeededFromNowFormatted = formatCurrency(amountNeededFromNow);
                let requiredContributionFormatted;
                if (timeframeType === 'years') {
                    requiredContributionFormatted = formatCurrency(requiredMonthlyContribution * 12);
                } else {
                    requiredContributionFormatted = formatCurrency(requiredMonthlyContribution);
                }

                const totalContributedAtEnd = currentSavings + (requiredMonthlyContribution * numberOfMonths);
                const totalContributedFormatted = formatCurrency(totalContributedAtEnd);
                const totalGrowthEarnedAtEnd = Math.max(0, goalAmount - totalContributedAtEnd);
                const totalGrowthEarnedFormatted = formatCurrency(totalGrowthEarnedAtEnd);


                if(amountToSaveEl) amountToSaveEl.textContent = amountNeededFromNowFormatted;
                if(requiredContributionEl) requiredContributionEl.textContent = requiredContributionFormatted;
                if(projectedFinalSavingsEl) projectedFinalSavingsEl.textContent = formatCurrency(goalAmount);
                if(totalContributedEl) totalContributedEl.textContent = totalContributedFormatted;
                if(totalGrowthEarnedEl) totalGrowthEarnedEl.textContent = totalGrowthEarnedFormatted;


                if(savingsResultsSection) savingsResultsSection.style.display = 'block';
                updateSavingsGoalChart(periodLabels, balanceData, contributionsData);

                 if(savingsResultsSection) {
                     savingsResultsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                 }

                 savingsCalculateBtn.innerHTML = '<i class="fas fa-map-signs"></i> Chart My Adventure!';
                 savingsCalculateBtn.disabled = false;

             }, 100); // Increased delay slightly for smoother UI update

        }

        function clearSavingsGoalResults() {
            if(amountToSaveEl) amountToSaveEl.textContent = 'R0.00';
            if(requiredContributionEl) requiredContributionEl.textContent = 'R0.00';
            if(projectedFinalSavingsEl) projectedFinalSavingsEl.textContent = 'R0.00';
            if(totalContributedEl) totalContributedEl.textContent = 'R0.00';
            if(totalGrowthEarnedEl) totalGrowthEarnedEl.textContent = 'R0.00';

            if(savingsResultsSection) savingsResultsSection.style.display = 'none';

            if (savingsGrowthChart) {
               savingsGrowthChart.destroy();
               savingsGrowthChart = null;
            }
            if (savingsGrowthCanvas) {
                 const ctx = savingsGrowthCanvas.getContext('2d');
                 if (ctx) {
                    ctx.clearRect(0, 0, savingsGrowthCanvas.width, savingsGrowthCanvas.height);
                 }
            }
        }


         function updateSavingsGoalChart(periods, balances, cumulativeContributions) {
             if (!savingsGrowthCanvas) {
                 console.error("Chart canvas element (#savingsGrowthChart) not found.");
                 return;
             }
            const ctx = savingsGrowthCanvas.getContext('2d');
             if (!ctx) {
                 console.error("Chart canvas context not found for #savingsGrowthChart.");
                 return;
             }

            if (savingsGrowthChart) {
                savingsGrowthChart.destroy();
            }

             let xAxisLabel = 'Period';
             if (periods && periods.length > 1 && typeof periods[1] === 'string') {
                 if (periods[1].toLowerCase().includes('month') || periods[1].toLowerCase().includes('mth')) {
                     xAxisLabel = 'Months';
                 } else if (periods[1].toLowerCase().includes('year')) {
                     xAxisLabel = 'Years';
                 }
             }


             savingsGrowthChart = new Chart(ctx, {
                 type: 'line',
                 data: {
                     labels: periods,
                     datasets: [
                         {
                            label: 'Projected Savings Balance',
                            data: balances,
                            borderColor: chartBalanceColor,
                            backgroundColor: chartBalanceFillColor,
                            fill: 'origin',
                            tension: 0.25, // Slightly more smoothing
                            pointRadius: 3,
                            pointHoverRadius: 6, // Larger hover radius
                            pointBackgroundColor: chartBalanceColor,
                            pointBorderColor: '#fff',
                            pointHoverBorderColor: chartBalanceColor,
                            pointHoverBorderWidth: 2,
                            cubicInterpolationMode: 'monotone'
                          },
                         {
                             label: 'Cumulative Contributions',
                             data: cumulativeContributions,
                             borderColor: chartContributionsColor,
                             backgroundColor: 'transparent',
                             fill: false,
                             tension: 0.25,
                             pointRadius: 3,
                             pointHoverRadius: 6,
                             pointBackgroundColor: chartContributionsColor,
                             pointBorderColor: '#fff',
                             pointHoverBorderColor: chartContributionsColor,
                             pointHoverBorderWidth: 2,
                             borderDash: [5, 5],
                             cubicInterpolationMode: 'monotone'
                         }
                     ]
                 },
                 options: {
                     responsive: true,
                     maintainAspectRatio: false,
                     plugins: {
                          legend: {
                              position: 'bottom',
                              labels: {
                                  boxWidth: 18, // Slightly larger
                                  padding: 20,
                                  font: { size: 13 } // Slightly larger
                              }
                          },
                          tooltip: {
                              callbacks: {
                                  label: function(context) {
                                      const label = context.dataset.label || '';
                                      const value = context.raw;
                                      return `${label}: ${formatCurrency(value)}`;
                                  },
                                  title: function(context) {
                                       return context[0].label;
                                  }
                              },
                              backgroundColor: 'rgba(0, 0, 0, 0.85)', // Darker
                              titleColor: '#fff',
                              bodyColor: '#fff',
                              borderColor: 'var(--primary)',
                              borderWidth: 1,
                              cornerRadius: 5, // More rounded
                              padding: 12 // More padding
                          }
                     },
                     scales: {
                         x: {
                             title: {
                                 display: true,
                                 text: xAxisLabel,
                                 font: { size: 14, weight: '600' }, // Bolder
                                 color: 'var(--text-light)'
                             },
                             grid: {
                                 display: false
                             },
                              ticks: {
                                  maxRotation: 45,
                                  minRotation: 0,
                                  font: { size: 11 } // Smaller ticks if many
                              }
                         },
                         y: {
                             title: {
                                 display: true,
                                 text: 'Amount (R)',
                                 font: { size: 14, weight: '600' },
                                 color: 'var(--text-light)'
                             },
                              ticks: {
                                   callback: function(value) {
                                       if (value >= 1000000) {
                                           return 'R' + (value / 1000000).toFixed(value % 1000000 !== 0 ? 1 : 0) + 'M';
                                       } else if (value >= 1000) {
                                           return 'R' + (value / 1000).toFixed(value % 1000 !== 0 ? 1 : 0) + 'K';
                                       }
                                       return formatCurrency(value);
                                   },
                                   font: { size: 11 }
                              },
                              grid: {
                                   color: 'var(--border)'
                              },
                              beginAtZero: true // Always start Y axis at zero
                         }
                     },
                     layout: {
                         padding: { top: 5, right: 10, bottom: 5, left: 5 } // Adjusted padding
                     },
                     interaction: { // Enhanced interaction
                         mode: 'index',
                         intersect: false,
                     },
                 }
             });
         }


        // Event Listeners
        if (savingsCalculateBtn) {
             savingsCalculateBtn.addEventListener('click', calculateSavingsGoal);
        } else {
             console.error("Critical: Savings Calculate Button (#savingsCalculateBtn) not found!");
        }

        if (savingsResetBtn) {
            savingsResetBtn.addEventListener('click', function() {
                if (savingsGoalForm) savingsGoalForm.reset(); // Reset form fields first

                setTimeout(function() { // Then clear results and UI elements
                    clearSavingsGoalResults();
                    document.querySelectorAll('.form-message').forEach(msg => {
                         msg.textContent = '';
                         msg.classList.remove('active');
                     });
                    document.querySelectorAll('.form-control').forEach(input => {
                          input.classList.remove('invalid');
                    });
                    if(timeframeTypeSelect && timeframeUnitSpan && requiredContributionLabelEl && timeframeInput) {
                         timeframeTypeSelect.value = 'years'; // Reset select
                         timeframeUnitSpan.textContent = 'Years';
                         requiredContributionLabelEl.textContent = 'Required Annual Stash:';
                         timeframeInput.value = 5;
                         timeframeInput.min = 1;
                         timeframeInput.max = 70;
                         timeframeInput.step = 1;
                    }
                    if (goalAmountInput) goalAmountInput.value = 100000;
                    if (currentSavingsInput) currentSavingsInput.value = 10000;
                    if (annualGrowthRateInput) annualGrowthRateInput.value = 6;

                    accordionItems.forEach(item => { // Close all accordions on reset
                        item.classList.remove('active');
                        const content = item.querySelector('.accordion-content');
                        if(content) {
                            content.style.maxHeight = null;
                        }
                    });
                }, 50);
            });
        }

         if (savingsGoalForm) {
             savingsGoalForm.addEventListener('keypress', function(event) {
                 if (event.key === 'Enter' && event.target.tagName !== 'TEXTAREA') { // Allow enter in textarea if any
                     event.preventDefault();
                     // Check if focused element is a button, if so, don't re-trigger
                     if (document.activeElement && document.activeElement.type === 'button') return;
                     calculateSavingsGoal();
                 }
             });
         }


        // --- Initial Load Logic ---
        window.addEventListener('load', function() {
            clearSavingsGoalResults(); // Start with a clean slate

            document.querySelectorAll('.form-message').forEach(msg => {
                 msg.textContent = '';
                 msg.classList.remove('active');
            });
            document.querySelectorAll('.form-control').forEach(input => {
                  input.classList.remove('invalid');
            });

            if(timeframeTypeSelect && timeframeUnitSpan && requiredContributionLabelEl) {
                 timeframeUnitSpan.textContent = timeframeTypeSelect.value === 'years' ? 'Years' : 'Months';
                 requiredContributionLabelEl.textContent = timeframeTypeSelect.value === 'years' ? 'Required Annual Stash:' : 'Required Monthly Stash:';
                 // Trigger change once on load to set min/max for timeframe input
                 timeframeTypeSelect.dispatchEvent(new Event('change'));
            }


            // --- Active Nav Link Highlighting ---
            const navLinks = document.querySelectorAll('.nav-menu .nav-link');
            const currentPath = window.location.pathname;

            navLinks.forEach(link => link.classList.remove('active')); // Clear all first

            let linkActivated = false;
            navLinks.forEach(link => {
                const linkHref = link.getAttribute('href');
                // Check if the current page is exactly this link
                if (currentPath.endsWith(linkHref) && linkHref !== '/') {
                    link.classList.add('active');
                    linkActivated = true;
                    return;
                }
                // Special handling for /#tools when on a calculator page
                if ((currentPath.includes('-calculator.html') || currentPath.includes('savings-goal-planner.html') || currentPath.includes('budget-planner.html') || currentPath.includes('loan-calculators.html') || currentPath.includes('vat-calculator.html') || currentPath.includes('retirement-calculator.html')) && linkHref === '/#tools') {
                    link.classList.add('active');
                    linkActivated = true;
                    // Don't return, allow specific page link to also be active if it matches later
                }
            });

            // Fallback for home page or if no specific link matched but on a tool page
            if (!linkActivated) {
                if (currentPath === '/' || currentPath.endsWith('/index.html')) {
                    const homeLink = document.querySelector('.nav-menu a[href="/"]');
                    if (homeLink) homeLink.classList.add('active');
                } else if (document.querySelector('.nav-menu a[href="/#tools"].active')) {
                    // If #tools is active, ensure no other primary nav link is also active unless it's a sub-page of tools
                    // This logic can get complex; the current approach is to prioritize the #tools link if on a tool page.
                }
            }
            // Ensure that if on a specific tool page, and #tools is active, the specific tool page link itself is NOT also active in the main nav (if it exists there)
            // The current logic should mostly handle this by activating the most specific link.
            // Final check: if #tools is active, and we are on savings-goal-planner.html, #tools should remain the primary active link.
             if (currentPath.endsWith('savings-goal-planner.html')) {
                 const toolsLink = document.querySelector('.nav-menu a[href="/#tools"]');
                 if (toolsLink) {
                     navLinks.forEach(l => l.classList.remove('active')); // Remove from all
                     toolsLink.classList.add('active'); // Set only #tools as active
                 }
             }
        });
    </script>
</body>
</html>
