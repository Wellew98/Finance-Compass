<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Planner | Financial Compass</title>
    <meta name="description" content="Create, manage and visualize your personal budget with our free South African budget planner tool. Track income, expenses and savings goals.">

    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.css" integrity="sha512-/zs32ZEJh+/EO2N1b0PEdoA10JkdC3zJ8L5FTiQu82LR9S/rOQNfQN7U59U9BC12swNeRAz3HSzIL2vpp4fv3w==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* --- Base Styles --- */
        :root {
            --primary: #0070D1; /* Blue */
            --primary-dark: #005bb1;
            --secondary: #00BC8C; /* Teal/Green */
            --secondary-dark: #009670;
            --text: #333333;
            --text-light: #666666;
            --background: #FFFFFF;
            --background-alt: #F9FBFD; /* Very light blue/grey */
            --border: #E1E8ED;
            --shadow: rgba(0, 0, 0, 0.05);
            --radius: 10px;

            /* Budget Planner Categories Colors */
            --income: #00BC8C;
            --housing: #0070D1;
            --utilities: #6C63FF;
            --food: #FFC107;
            --transport: #FF6B6B;
            --debt: #DC3545;
            --personal: #9C27B0;
            --savings: #28A745;
            --entertainment: #FF9800;
            --miscellaneous: #6C757D;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth; /* Smooth scrolling for anchor links */
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text);
            line-height: 1.6;
            background-color: var(--background);
            -webkit-font-smoothing: antialiased; /* Smoother fonts */
            -moz-osx-font-smoothing: grayscale;
        }

        a {
            text-decoration: none;
            color: var(--primary);
            transition: color 0.3s;
        }

        a:hover {
            color: var(--primary-dark);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        img {
             max-width: 100%;
             height: auto;
             display: block; /* Prevents bottom space */
        }

        /* --- Buttons --- */
        .btn {
            display: inline-block;
            padding: 12px 28px;
            background-color: var(--primary);
            color: white;
            border-radius: var(--radius);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent; /* Added for consistent height with outline */
            text-align: center;
            font-size: 1rem; /* Ensure consistent font size */
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 112, 209, 0.2);
        }

        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
            box-shadow: 0 4px 12px rgba(0, 188, 140, 0.2);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.9rem;
        }

         button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* --- Sections & Titles --- */
        .section {
            padding: 80px 0;
        }

        .section-title {
            font-size: 2.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
            color: var(--text);
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-light);
            text-align: center;
            max-width: 700px;
            margin: 0 auto 3rem;
        }

        /* --- Cards --- */
         .card {
            background-color: var(--background);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 6px 18px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border);
         }

         .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
         }

        /* --- Header --- */
        header {
            background-color: var(--background);
            box-shadow: 0 2px 10px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0; /* Adjust as needed */
            height: 73px; /* Explicit height for menu positioning */
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text);
        }

        .logo i {
            color: var(--primary);
            margin-right: 10px;
            font-size: 1.8rem;
        }

        .logo span {
             color: var(--primary);
        }

        .nav-menu {
            display: flex;
            list-style: none;
        }

        .nav-item {
            margin-left: 28px;
        }

        .nav-link {
            color: var(--text);
            font-weight: 500;
            padding: 8px 4px;
            position: relative;
            font-size: 1rem;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px; /* Position slightly below text */
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after,
        .nav-link.active::after {
             width: 100%;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text);
            padding: 5px; /* Easier to tap */
        }

        /* --- Page Header --- */
        .page-header {
            background: linear-gradient(135deg, #F9FBFD, #EEF2F7);
            padding: 60px 0;
            text-align: center;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text);
        }

        .page-description {
            font-size: 1.1rem;
            color: var(--text-light);
            max-width: 700px;
            margin: 0 auto;
        }

        /* --- Budget Planner Styles --- */
        .budget-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .budget-intro {
            margin-bottom: 2rem;
            text-align: center;
        }

        .budget-tools {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            gap: 15px;
            flex-wrap: wrap;
        }

        .budget-tools-left, .budget-tools-right {
            display: flex;
            gap: 10px;
            flex-wrap: wrap; /* Allow wrapping within tool groups */
        }

        .budget-form {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        .budget-section {
            background-color: var(--background);
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow);
            padding: 2rem;
            overflow: hidden;
        }

        .budget-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .budget-section-title {
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--text);
        }

        .budget-section-title i {
            width: 30px;
            text-align: center;
        }

        .income-icon { color: var(--income); }
        .housing-icon { color: var(--housing); }
        .utilities-icon { color: var(--utilities); }
        .food-icon { color: var(--food); }
        .transport-icon { color: var(--transport); }
        .debt-icon { color: var(--debt); }
        .personal-icon { color: var(--personal); }
        .savings-icon { color: var(--savings); }
        .entertainment-icon { color: var(--entertainment); }
        .misc-icon { color: var(--miscellaneous); }

        .section-total {
             font-weight: 600;
             color: var(--text-light);
         }

        .budget-line {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
            gap: 15px; /* Add gap for spacing */
        }

        .budget-line:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .budget-line-title {
            flex: 1;
            font-weight: 500;
        }

        .budget-input-group {
            position: relative;
            width: 180px;
        }

        .budget-input-group span {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-weight: 500;
            user-select: none; /* Prevent text selection */
        }

        .budget-input {
            width: 100%;
            padding: 10px 10px 10px 30px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s;
            font-size: 1rem;
             /* Allow browser to handle number input styling */
             -moz-appearance: textfield;
        }
        .budget-input::-webkit-outer-spin-button,
        .budget-input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        .budget-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 112, 209, 0.15);
        }

        .add-item-btn {
            color: var(--primary);
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 15px;
            padding: 5px 0;
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
        }

        .add-item-btn:hover {
            color: var(--primary-dark);
        }

        .budget-summary {
            margin-top: 2rem;
        }
        .budget-summary h2 {
             text-align: center;
             margin-bottom: 1.5rem;
             font-weight: 600;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .summary-card {
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow);
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--background);
            border: 1px solid var(--border);
        }

        .summary-card.income { border-top: 4px solid var(--income); }
        .summary-card.expenses { border-top: 4px solid var(--debt); }
        .summary-card.balance { border-top: 4px solid var(--primary); }

        .summary-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-light);
            margin-bottom: 0.5rem;
        }

        .summary-amount {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .summary-amount.positive { color: var(--income); }
        .summary-amount.negative { color: var(--debt); }
        .summary-amount.neutral { color: var(--primary); }

        .charts-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .chart-card {
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow);
            background-color: var(--background);
            border: 1px solid var(--border);
        }

        .chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }

        /* --- Budget Tips Section --- */
        .tips-section {
            background-color: var(--background-alt);
            padding: 4rem 0;
            margin-top: 3rem;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .tip-card {
            padding: 1.5rem;
            border-radius: var(--radius);
            box-shadow: 0 4px 15px var(--shadow);
            background-color: var(--background);
            border-left: 4px solid var(--primary);
        }

        .tip-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
        }

        .tip-content {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        /* Budget Actions */
        .budget-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 2rem;
            flex-wrap: wrap; /* Allow buttons to wrap */
        }

        /* Added Item Container */
        .added-items {
            margin-top: 1rem;
            padding-left: 15px; /* Indent custom items */
        }

        .added-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px dashed var(--border);
        }

        .added-item:last-child {
            border-bottom: none;
        }

        .added-item-name {
            flex: 1;
            font-style: italic;
            color: var(--text-light);
            margin-right: 10px; /* Space before value */
        }

        .added-item-value {
            margin-right: 15px;
            font-weight: 500;
        }

        .delete-item {
            color: #dc3545;
            cursor: pointer;
            padding: 5px;
            border: none;
            background: none;
            opacity: 0.7;
            transition: opacity 0.2s;
            font-size: 0.9em; /* Make delete icon slightly smaller */
        }

        .delete-item:hover {
            opacity: 1;
        }

        /* Custom field input */
        .custom-field-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            display: none; /* Hidden by default */
            padding-left: 15px; /* Indent add field */
        }

        .custom-field-container.active {
            display: flex; /* Show when active */
        }

        .custom-field-input {
            flex: 1;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
        }

        .custom-field-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 112, 209, 0.15);
        }
        /* Adjust custom input number width */
        .custom-field-container .budget-input-group {
             width: 150px; /* Slightly smaller */
         }

        .add-custom-btn, .cancel-custom-btn {
             padding: 10px 15px;
             border: none;
             border-radius: var(--radius);
             cursor: pointer;
             font-family: 'Poppins', sans-serif;
             color: white;
             font-size: 0.9rem;
             transition: background-color 0.2s;
         }

        .add-custom-btn {
            background-color: var(--primary);
        }
        .add-custom-btn:hover {
            background-color: var(--primary-dark);
        }

        .cancel-custom-btn {
            background-color: #6c757d; /* Grey */
        }
        .cancel-custom-btn:hover {
            background-color: #5a6268;
        }


        /* --- Footer --- */
        footer {
            background-color: #1e293b;
            color: rgba(255, 255, 255, 0.8);
            padding: 64px 0 32px;
            font-size: 0.95rem;
            margin-top: 4rem; /* Add space above footer */
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 48px;
            margin-bottom: 48px;
        }

        .footer-column.about .footer-logo {
             color: white;
             font-size: 1.6rem;
             margin-bottom: 16px;
             display: inline-flex; /* Align icon and text */
             align-items: center;
        }
        .footer-column.about .footer-logo i {
             color: var(--primary);
             margin-right: 10px;
        }


        .footer-description {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 24px;
            line-height: 1.7;
        }

        .footer-social {
            display: flex;
            gap: 12px;
        }

        .footer-social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .footer-social-link:hover {
            background-color: var(--primary);
            transform: translateY(-3px);
        }

        .footer-heading {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 24px;
            color: white;
        }

        .footer-links {
            list-style: none;
            padding: 0; /* Remove default padding */
        }

        .footer-link {
            margin-bottom: 12px;
        }

        .footer-link a {
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
        }

        .footer-link a:hover {
            color: white;
            padding-left: 5px;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            padding-top: 32px;
            margin-top: 16px; /* Add margin above bottom line */
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.875rem;
        }

        /* --- Responsive Styles --- */
        @media (max-width: 992px) {
            .nav-menu {
                position: fixed;
                top: 73px; /* Match header height */
                left: -100%;
                flex-direction: column;
                background-color: var(--background);
                width: 100%;
                height: calc(100vh - 73px);
                transition: left 0.3s ease-in-out;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
                padding: 20px 0; /* Add padding top/bottom */
                overflow-y: auto;
                z-index: 999; /* Ensure it's below header but above content */
             }

             .nav-menu.active {
                left: 0;
             }

             .nav-item {
                margin: 0;
                width: 100%;
             }
             .nav-link {
                 display: block;
                 padding: 16px 30px; /* Increase padding */
                 text-align: left; /* Align text left */
                 border-bottom: 1px solid var(--border);
                 font-size: 1.1rem; /* Slightly larger font */
             }
             .nav-link:hover {
                 background-color: var(--background-alt);
             }
              .nav-link::after {
                 display: none; /* Hide underline on mobile */
             }
             /* Style last nav item without border */
             .nav-item:last-child .nav-link {
                 border-bottom: none;
             }


             .mobile-menu-btn {
                 display: block;
             }
        }

        @media (max-width: 768px) {
            .section {
                padding: 64px 0;
            }
            .section-title {
                font-size: 2rem;
            }
            .page-header {
                padding: 50px 0;
            }
            .page-title {
                font-size: 2.2rem;
            }
            .page-description {
                font-size: 1.1rem;
            }
            .budget-tools {
                flex-direction: column;
                align-items: center; /* Center tools when stacked */
            }
            .budget-tools-left, .budget-tools-right {
                justify-content: center;
                 width: 100%; /* Make tool groups take full width */
            }
            .budget-section {
                padding: 1.5rem;
            }
            .charts-container {
                grid-template-columns: 1fr;
            }
            .summary-grid {
                grid-template-columns: 1fr;
            }
            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            .footer-column {
                 display: flex;
                 flex-direction: column;
                 align-items: center;
            }
             .footer-column.about .footer-logo {
                 justify-content: center; /* Center logo items */
             }
            .footer-social {
                 justify-content: center;
            }
            .footer-links {
                 text-align: center;
            }
             .budget-line {
                 flex-direction: column;
                 align-items: flex-start;
                 gap: 10px;
                 padding-bottom: 1.5rem; /* Add more space when stacked */
                 margin-bottom: 1.5rem;
             }
             .budget-input-group {
                 width: 100%; /* Make input full width */
             }
             .custom-field-container {
                 flex-direction: column;
                 align-items: stretch; /* Stretch items full width */
             }
             .custom-field-container .budget-input-group {
                  width: 100%; /* Make custom value input full width */
              }
        }

         @media (max-width: 576px) {
             .section-title {
                 font-size: 1.75rem;
             }
             .page-title {
                 font-size: 1.8rem;
             }
             .page-description {
                 font-size: 1rem;
             }
             .budget-actions {
                 flex-direction: column;
                 gap: 10px;
             }
             .btn {
                 width: 100%; /* Make buttons full width */
                 max-width: none;
             }
             .header-container {
                 padding: 12px 0; /* Reduce header padding */
                 height: 65px; /* Adjust height */
             }
             .nav-menu {
                 top: 65px; /* Match new header height */
                 height: calc(100vh - 65px);
             }
             .logo {
                 font-size: 1.4rem;
             }
             .logo i {
                 font-size: 1.6rem;
             }
         }

         body.no-scroll {
             overflow: hidden;
         }
         /* Print styles */
        @media print {
            header, footer, .budget-tools, .add-item-btn, .custom-field-container, .budget-actions, .tips-section, .mobile-menu-btn, .delete-item, .budget-summary .budget-actions {
                display: none !important;
            }
            body {
                font-size: 10pt;
                color: #000;
                background-color: #fff;
            }
            .container {
                max-width: 100%;
                padding: 0;
                margin: 0;
            }
             .page-header {
                background: none;
                padding: 20px 0;
                text-align: left;
             }
            .budget-section {
                box-shadow: none;
                border: 1px solid #ccc;
                padding: 1rem;
                margin-bottom: 1rem;
                page-break-inside: avoid; /* Prevent sections breaking across pages */
            }
             .budget-section-header {
                 border-bottom: 1px solid #ccc;
                 margin-bottom: 1rem;
                 padding-bottom: 0.5rem;
             }
             .budget-section-title { font-size: 1.2rem; }
             .section-total { font-size: 1rem; }

            .budget-line {
                 border-bottom: 1px dotted #eee;
                 flex-direction: row; /* Ensure lines stay rows in print */
                 align-items: center;
                 gap: 10px;
                 padding-bottom: 0.5rem;
                 margin-bottom: 0.5rem;
            }
             .budget-line-title { flex-basis: 50%; flex-grow: 1;}
             .budget-input-group { width: auto; flex-basis: 30%; }
             .budget-input { border: none; padding: 2px 2px 2px 20px; background: #f8f8f8;} /* Show value, but not as editable input */
             .budget-input-group span { display: block; position: static; transform: none; margin-right: 5px; font-weight: bold; } /* Show R symbol */

             .added-items { margin-top: 0.5rem; padding-left: 10px;}
             .added-item { padding: 0.25rem 0; border-bottom: 1px dotted #eee;}
             .added-item-name { font-style: normal; color: #333; flex-basis: 50%; flex-grow: 1;}
             .added-item-value { margin-right: 0; font-weight: normal; flex-basis: 30%;}
             .added-item-value::before { content: "R "; } /* Add currency symbol */

            .summary-grid, .charts-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                page-break-inside: avoid;
                margin-bottom: 1rem;
            }
            .summary-card, .chart-card {
                 box-shadow: none;
                 border: 1px solid #ccc;
                 padding: 1rem;
            }
             .summary-card { text-align: left; flex-direction: row; justify-content: space-between;}
             .summary-title { margin-bottom: 0;}
            .summary-amount { font-size: 1.5rem; }
            .chart-container { height: 250px; } /* Smaller charts for print */
            a { text-decoration: none; color: #000; }
            .btn { display: none; } /* Ensure all buttons hidden */
             .tips-section { display: none !important; } /* Hide tips section */
             .budget-summary { margin-top: 1rem; }
             .budget-summary h2 { text-align: left; margin-bottom: 1rem; }

        }

    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <a href="/" class="logo"> <i class="fas fa-compass"></i> Financial<span>Compass</span>
            </a>

            <nav>
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Open Menu" aria-expanded="false" aria-controls="navMenu">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="nav-menu" id="navMenu">
                    <li class="nav-item"><a href="index.html" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="#" class="nav-link active">Financial Tools</a></li>
                    <li class="nav-item"><a href="index.html#about" class="nav-link">Why Us</a></li>
                    <li class="nav-item"><a href="index.html#updates" class="nav-link">Updates</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="page-header">
        <div class="container">
            <h1 class="page-title">Comprehensive Budget Planner</h1>
            <p class="page-description">Create, manage, and visualize your monthly budget. Track income, expenses, and savings goals to take control of your finances.</p>
        </div>
    </section>

    <section class="section">
        <div class="container budget-container">
            <div class="budget-intro">
                <h2>Create Your Monthly Budget</h2>
                <p>Fill in the amounts below to get a clear picture of your monthly finances. Add custom items as needed for a personalized budget.</p>
            </div>

            <div class="budget-tools">
                <div class="budget-tools-left">
                    <button class="btn btn-outline" id="resetBtn">
                        <i class="fas fa-redo-alt"></i> Reset Form
                    </button>
                    <button class="btn btn-outline" id="sampleDataBtn">
                        <i class="fas fa-lightbulb"></i> Sample Data
                    </button>
                </div>
                <div class="budget-tools-right">
                    <button class="btn btn-secondary" id="saveLocalBtn">
                        <i class="fas fa-save"></i> Save Budget
                    </button>
                    <button class="btn btn-primary" id="printBtn">
                        <i class="fas fa-print"></i> Print Budget
                    </button>
                </div>
            </div>

            <form class="budget-form" id="budgetForm">
                <div class="budget-section" data-category="income">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-money-bill-wave income-icon"></i> Monthly Income</h3>
                        <div class="section-total">Total: <span id="incomeTotal">R0.00</span></div>
                    </div>
                    <div class="budget-line">
                        <label for="salary" class="budget-line-title">Salary (After Tax)</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input income-input" id="salary" placeholder="0" step="0.01" min="0" data-item-name="Salary (After Tax)">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="sideJobs" class="budget-line-title">Side Jobs/Freelance</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input income-input" id="sideJobs" placeholder="0" step="0.01" min="0" data-item-name="Side Jobs/Freelance">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="investmentIncome" class="budget-line-title">Investment Income</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input income-input" id="investmentIncome" placeholder="0" step="0.01" min="0" data-item-name="Investment Income">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="socialGrants" class="budget-line-title">Social Grants</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input income-input" id="socialGrants" placeholder="0" step="0.01" min="0" data-item-name="Social Grants">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="otherIncome" class="budget-line-title">Other Income</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input income-input" id="otherIncome" placeholder="0" step="0.01" min="0" data-item-name="Other Income">
                        </div>
                    </div>
                    <div id="incomeCustomItems" class="added-items"></div>
                    <button type="button" class="add-item-btn" data-category="income">
                        <i class="fas fa-plus-circle"></i> Add Income Source
                    </button>
                    <div class="custom-field-container" id="incomeCustomField">
                        <input type="text" class="custom-field-input" placeholder="Item name (e.g., Rental Income)">
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>

                <div class="budget-section" data-category="housing">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-home housing-icon"></i> Housing</h3>
                        <div class="section-total">Total: <span id="housingTotal">R0.00</span></div>
                    </div>
                     <div class="budget-line">
                        <label for="rent" class="budget-line-title">Rent/Mortgage</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input housing-input" id="rent" placeholder="0" step="0.01" min="0" data-item-name="Rent/Mortgage">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="propertyRates" class="budget-line-title">Property Rates</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input housing-input" id="propertyRates" placeholder="0" step="0.01" min="0" data-item-name="Property Rates">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="homeInsurance" class="budget-line-title">Home Insurance</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input housing-input" id="homeInsurance" placeholder="0" step="0.01" min="0" data-item-name="Home Insurance">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="repairs" class="budget-line-title">Maintenance/Repairs</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input housing-input" id="repairs" placeholder="0" step="0.01" min="0" data-item-name="Maintenance/Repairs">
                        </div>
                    </div>
                    <div id="housingCustomItems" class="added-items"></div>
                    <button type="button" class="add-item-btn" data-category="housing">
                        <i class="fas fa-plus-circle"></i> Add Housing Expense
                    </button>
                    <div class="custom-field-container" id="housingCustomField">
                         <input type="text" class="custom-field-input" placeholder="Item name (e.g., Levies)">
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>

                 <div class="budget-section" data-category="utilities">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-bolt utilities-icon"></i> Utilities</h3>
                        <div class="section-total">Total: <span id="utilitiesTotal">R0.00</span></div>
                    </div>
                     <div class="budget-line">
                        <label for="electricity" class="budget-line-title">Electricity</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input utilities-input" id="electricity" placeholder="0" step="0.01" min="0" data-item-name="Electricity">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="water" class="budget-line-title">Water & Sewerage</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input utilities-input" id="water" placeholder="0" step="0.01" min="0" data-item-name="Water & Sewerage">
                        </div>
                    </div>
                     <div class="budget-line">
                        <label for="refuse" class="budget-line-title">Refuse Removal</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input utilities-input" id="refuse" placeholder="0" step="0.01" min="0" data-item-name="Refuse Removal">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="internet" class="budget-line-title">Internet/WiFi</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input utilities-input" id="internet" placeholder="0" step="0.01" min="0" data-item-name="Internet/WiFi">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="cellPhone" class="budget-line-title">Cell Phone</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input utilities-input" id="cellPhone" placeholder="0" step="0.01" min="0" data-item-name="Cell Phone">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="television" class="budget-line-title">Television/Streaming</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input utilities-input" id="television" placeholder="0" step="0.01" min="0" data-item-name="Television/Streaming">
                        </div>
                    </div>
                    <div id="utilitiesCustomItems" class="added-items"></div>
                    <button type="button" class="add-item-btn" data-category="utilities">
                        <i class="fas fa-plus-circle"></i> Add Utility Expense
                    </button>
                    <div class="custom-field-container" id="utilitiesCustomField">
                         <input type="text" class="custom-field-input" placeholder="Item name (e.g., Security)">
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>

                <div class="budget-section" data-category="food">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-utensils food-icon"></i> Food</h3>
                        <div class="section-total">Total: <span id="foodTotal">R0.00</span></div>
                    </div>
                    <div class="budget-line">
                        <label for="groceries" class="budget-line-title">Groceries</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input food-input" id="groceries" placeholder="0" step="0.01" min="0" data-item-name="Groceries">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="eatingOut" class="budget-line-title">Eating Out</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input food-input" id="eatingOut" placeholder="0" step="0.01" min="0" data-item-name="Eating Out">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="takeaways" class="budget-line-title">Takeaways/Deliveries</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input food-input" id="takeaways" placeholder="0" step="0.01" min="0" data-item-name="Takeaways/Deliveries">
                        </div>
                    </div>
                    <div id="foodCustomItems" class="added-items"></div>
                    <button type="button" class="add-item-btn" data-category="food">
                        <i class="fas fa-plus-circle"></i> Add Food Expense
                    </button>
                    <div class="custom-field-container" id="foodCustomField">
                         <input type="text" class="custom-field-input" placeholder="Item name (e.g., Coffee Shops)">
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>

                 <div class="budget-section" data-category="transport">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-car transport-icon"></i> Transport</h3>
                        <div class="section-total">Total: <span id="transportTotal">R0.00</span></div>
                    </div>
                    <div class="budget-line">
                        <label for="carPayment" class="budget-line-title">Car Payment</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input transport-input" id="carPayment" placeholder="0" step="0.01" min="0" data-item-name="Car Payment">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="fuel" class="budget-line-title">Fuel</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input transport-input" id="fuel" placeholder="0" step="0.01" min="0" data-item-name="Fuel">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="carInsurance" class="budget-line-title">Car Insurance</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input transport-input" id="carInsurance" placeholder="0" step="0.01" min="0" data-item-name="Car Insurance">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="carMaintenance" class="budget-line-title">Maintenance/Service</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input transport-input" id="carMaintenance" placeholder="0" step="0.01" min="0" data-item-name="Maintenance/Service">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="publicTransport" class="budget-line-title">Public Transport</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input transport-input" id="publicTransport" placeholder="0" step="0.01" min="0" data-item-name="Public Transport">
                        </div>
                    </div>
                    <div id="transportCustomItems" class="added-items"></div>
                    <button type="button" class="add-item-btn" data-category="transport">
                        <i class="fas fa-plus-circle"></i> Add Transport Expense
                    </button>
                     <div class="custom-field-container" id="transportCustomField">
                         <input type="text" class="custom-field-input" placeholder="Item name (e.g., Toll Fees)">
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>

                <div class="budget-section" data-category="debt">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-credit-card debt-icon"></i> Debt Repayments</h3>
                        <div class="section-total">Total: <span id="debtTotal">R0.00</span></div>
                    </div>
                     <div class="budget-line">
                        <label for="personalLoan" class="budget-line-title">Personal Loan</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input debt-input" id="personalLoan" placeholder="0" step="0.01" min="0" data-item-name="Personal Loan">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="creditCard" class="budget-line-title">Credit Card</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input debt-input" id="creditCard" placeholder="0" step="0.01" min="0" data-item-name="Credit Card">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="studentLoan" class="budget-line-title">Student Loan</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input debt-input" id="studentLoan" placeholder="0" step="0.01" min="0" data-item-name="Student Loan">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="storeAccounts" class="budget-line-title">Store Accounts</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input debt-input" id="storeAccounts" placeholder="0" step="0.01" min="0" data-item-name="Store Accounts">
                        </div>
                    </div>
                    <div id="debtCustomItems" class="added-items"></div>
                     <button type="button" class="add-item-btn" data-category="debt">
                        <i class="fas fa-plus-circle"></i> Add Debt Payment
                    </button>
                     <div class="custom-field-container" id="debtCustomField">
                        <input type="text" class="custom-field-input" placeholder="Item name (e.g., Overdraft)">
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>

                <div class="budget-section" data-category="personal">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-user personal-icon"></i> Personal Expenses</h3>
                        <div class="section-total">Total: <span id="personalTotal">R0.00</span></div>
                    </div>
                    <div class="budget-line">
                        <label for="medicalAid" class="budget-line-title">Medical Aid</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input personal-input" id="medicalAid" placeholder="0" step="0.01" min="0" data-item-name="Medical Aid">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="medicine" class="budget-line-title">Medicine/Pharmacy</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input personal-input" id="medicine" placeholder="0" step="0.01" min="0" data-item-name="Medicine/Pharmacy">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="clothing" class="budget-line-title">Clothing</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input personal-input" id="clothing" placeholder="0" step="0.01" min="0" data-item-name="Clothing">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="personalCare" class="budget-line-title">Personal Care</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input personal-input" id="personalCare" placeholder="0" step="0.01" min="0" data-item-name="Personal Care">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="childcare" class="budget-line-title">Childcare/School Fees</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input personal-input" id="childcare" placeholder="0" step="0.01" min="0" data-item-name="Childcare/School Fees">
                        </div>
                    </div>
                    <div id="personalCustomItems" class="added-items"></div>
                     <button type="button" class="add-item-btn" data-category="personal">
                        <i class="fas fa-plus-circle"></i> Add Personal Expense
                    </button>
                     <div class="custom-field-container" id="personalCustomField">
                        <input type="text" class="custom-field-input" placeholder="Item name (e.g., Gym)">
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>

                <div class="budget-section" data-category="savings">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-piggy-bank savings-icon"></i> Savings & Investments</h3>
                        <div class="section-total">Total: <span id="savingsTotal">R0.00</span></div>
                    </div>
                    <div class="budget-line">
                        <label for="emergencyFund" class="budget-line-title">Emergency Fund</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input savings-input" id="emergencyFund" placeholder="0" step="0.01" min="0" data-item-name="Emergency Fund">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="retirementFund" class="budget-line-title">Retirement Fund (RA/Pension)</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input savings-input" id="retirementFund" placeholder="0" step="0.01" min="0" data-item-name="Retirement Fund (RA/Pension)">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="taxFreeSavings" class="budget-line-title">Tax-Free Savings (TFSA)</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input savings-input" id="taxFreeSavings" placeholder="0" step="0.01" min="0" data-item-name="Tax-Free Savings (TFSA)">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="goalSavings" class="budget-line-title">Goal-specific Savings (e.g., Holiday)</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input savings-input" id="goalSavings" placeholder="0" step="0.01" min="0" data-item-name="Goal-specific Savings">
                        </div>
                    </div>
                     <div class="budget-line">
                        <label for="otherInvestments" class="budget-line-title">Other Investments</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input savings-input" id="otherInvestments" placeholder="0" step="0.01" min="0" data-item-name="Other Investments">
                        </div>
                    </div>
                    <div id="savingsCustomItems" class="added-items"></div>
                     <button type="button" class="add-item-btn" data-category="savings">
                        <i class="fas fa-plus-circle"></i> Add Savings Category
                    </button>
                    <div class="custom-field-container" id="savingsCustomField">
                        <input type="text" class="custom-field-input" placeholder="Item name (e.g., House Deposit)">
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>

                <div class="budget-section" data-category="entertainment">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-film entertainment-icon"></i> Entertainment</h3>
                        <div class="section-total">Total: <span id="entertainmentTotal">R0.00</span></div>
                    </div>
                    <div class="budget-line">
                        <label for="subscriptions" class="budget-line-title">Subscriptions (Non-Utility)</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input entertainment-input" id="subscriptions" placeholder="0" step="0.01" min="0" data-item-name="Subscriptions">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="moviesEvents" class="budget-line-title">Movies/Events</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input entertainment-input" id="moviesEvents" placeholder="0" step="0.01" min="0" data-item-name="Movies/Events">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="hobbies" class="budget-line-title">Hobbies</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input entertainment-input" id="hobbies" placeholder="0" step="0.01" min="0" data-item-name="Hobbies">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="travel" class="budget-line-title">Holidays/Travel (Non-Savings)</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input entertainment-input" id="travel" placeholder="0" step="0.01" min="0" data-item-name="Holidays/Travel">
                        </div>
                    </div>
                    <div id="entertainmentCustomItems" class="added-items"></div>
                    <button type="button" class="add-item-btn" data-category="entertainment">
                        <i class="fas fa-plus-circle"></i> Add Entertainment Expense
                    </button>
                    <div class="custom-field-container" id="entertainmentCustomField">
                        <input type="text" class="custom-field-input" placeholder="Item name (e.g., Sports Club)">
                        <div class="budget-input-group">
                            <span>R</span>
                           <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>

                <div class="budget-section" data-category="miscellaneous">
                    <div class="budget-section-header">
                        <h3 class="budget-section-title"><i class="fas fa-ellipsis-h misc-icon"></i> Miscellaneous</h3>
                        <div class="section-total">Total: <span id="miscTotal">R0.00</span></div>
                    </div>
                    <div class="budget-line">
                        <label for="donations" class="budget-line-title">Donations/Charity</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input misc-input" id="donations" placeholder="0" step="0.01" min="0" data-item-name="Donations/Charity">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="gifts" class="budget-line-title">Gifts</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input misc-input" id="gifts" placeholder="0" step="0.01" min="0" data-item-name="Gifts">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="education" class="budget-line-title">Education (Non-Loan)</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input misc-input" id="education" placeholder="0" step="0.01" min="0" data-item-name="Education (Non-Loan)">
                        </div>
                    </div>
                    <div class="budget-line">
                        <label for="unexpected" class="budget-line-title">Unexpected Expenses</label>
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input expense-input misc-input" id="unexpected" placeholder="0" step="0.01" min="0" data-item-name="Unexpected Expenses">
                        </div>
                    </div>
                     <div id="miscCustomItems" class="added-items"></div>
                     <button type="button" class="add-item-btn" data-category="miscellaneous">
                        <i class="fas fa-plus-circle"></i> Add Miscellaneous Expense
                    </button>
                    <div class="custom-field-container" id="miscCustomField">
                        <input type="text" class="custom-field-input" placeholder="Item name">
                        <div class="budget-input-group">
                            <span>R</span>
                            <input type="number" class="budget-input custom-value-input" placeholder="0" step="0.01" min="0">
                        </div>
                        <button type="button" class="add-custom-btn">Add</button>
                        <button type="button" class="cancel-custom-btn">Cancel</button>
                    </div>
                </div>
            </form>

            <div class="budget-actions">
                <button class="btn btn-primary" id="calculateBtn">
                    <i class="fas fa-calculator"></i> Calculate / Recalculate Budget
                </button>
            </div>

            <div class="budget-summary" id="summarySection" style="display: none;">
                 <h2>Budget Summary</h2>
                <div class="summary-grid">
                    <div class="summary-card income">
                        <h3 class="summary-title">Total Monthly Income</h3>
                        <div class="summary-amount positive" id="summaryIncome">R0.00</div>
                    </div>
                    <div class="summary-card expenses">
                        <h3 class="summary-title">Total Monthly Expenses</h3>
                        <div class="summary-amount negative" id="summaryExpenses">R0.00</div>
                    </div>
                    <div class="summary-card balance">
                        <h3 class="summary-title">Monthly Balance</h3>
                        <div class="summary-amount neutral" id="summaryBalance">R0.00</div>
                    </div>
                </div>

                <div class="charts-container">
                    <div class="chart-card">
                        <h3 class="chart-title">Income vs Expenses</h3>
                        <div class="chart-container">
                            <canvas id="incomeExpensesChart"></canvas>
                        </div>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">Expense Breakdown</h3>
                        <div class="chart-container">
                            <canvas id="expensesChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="tips-section">
        <div class="container">
            <h2 class="section-title">Smart Budgeting Tips</h2>
            <p class="section-subtitle">Follow these strategies to make the most of your budget and improve your financial health.</p>

            <div class="tips-grid">
                 <div class="tip-card">
                    <h3 class="tip-title">Use the 50/30/20 Rule</h3>
                    <p class="tip-content">Allocate roughly 50% of your after-tax income to Needs (housing, food, transport), 30% to Wants (entertainment, hobbies), and 20% to Savings & Debt repayment.</p>
                </div>
                <div class="tip-card">
                    <h3 class="tip-title">Build an Emergency Fund</h3>
                    <p class="tip-content">Aim to save 3-6 months' worth of essential living expenses in an easily accessible account for unexpected events like job loss or medical bills.</p>
                </div>
                <div class="tip-card">
                    <h3 class="tip-title">Track Every Rand</h3>
                    <p class="tip-content">Use your budget to monitor where your money actually goes. Small, frequent expenses can add up quickly. Adjust spending habits based on your findings.</p>
                </div>
                 <div class="tip-card">
                    <h3 class="tip-title">Review & Adjust Regularly</h3>
                    <p class="tip-content">Your budget isn't static. Review it monthly or quarterly to account for income changes, new goals, or shifting expense patterns.</p>
                </div>
                 <div class="tip-card">
                    <h3 class="tip-title">Automate Savings</h3>
                    <p class="tip-content">Set up automatic transfers to your savings or investment accounts each payday. Treat savings like a bill you have to pay.</p>
                </div>
                <div class="tip-card">
                    <h3 class="tip-title">Distinguish Needs vs. Wants</h3>
                    <p class="tip-content">Be honest about what's essential versus discretionary. This helps identify areas where you can cut back if needed to reach savings goals faster.</p>
                </div>
            </div>
        </div>
    </section>


    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column about">
                    <a href="/" class="footer-logo">
                        <i class="fas fa-compass"></i> Financial<span>Compass</span>
                    </a>
                    <p class="footer-description">Your free guide to navigating South African personal finance. Empowering you with clear, accurate tools and insights.</p>
                    <div class="footer-social">
                        <a href="#" class="footer-social-link" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="footer-social-link" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="footer-social-link" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>

                <div class="footer-column links">
                    <h3 class="footer-heading">Quick Links</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="/">Home</a></li>
                        <li class="footer-link"><a href="#tools">Financial Tools</a></li>
                        <li class="footer-link"><a href="#about">Why Choose Us</a></li>
                        <li class="footer-link"><a href="#updates">Latest Updates</a></li>
                        <li class="footer-link"><a href="terms-privacy.html">Terms & Privacy</a></li>
                        </ul>
                </div>

                <div class="footer-column calculators">
                    <h3 class="footer-heading">Calculators</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="sars-tax-calculator.html">SARS Tax Calculator</a></li>
                        <li class="footer-link"><a href="budget-planner.html">Budget Planner</a></li>
                        <li class="footer-link"><a href="loan-calculators.html">Loan Calculators</a></li>
                        <li class="footer-link"><a href="vat-calculator.html">VAT Calculator</a></li>
                        <li class="footer-link"><a href="retirement-calculator.html">Retirement Calculator</a></li>
                        <li class="footer-link"><a href="savings-goal-planner.html">Savings Goal Planner</a></li>
                    </ul>
                </div>

                <div class="footer-column contact">
                    <h3 class="footer-heading">Disclaimer</h3>
                    <p class="footer-description" style="font-size: 0.85rem; color: rgba(255,255,255,0.5);">
                        Financial Compass provides tools for estimation purposes only. Information should not be considered financial advice. Always consult a qualified professional for financial decisions.
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                 &copy; <span id="currentYear"></span> Financial Compass. Built for South Africans. All Rights Reserved.
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" integrity="sha512-d9xgZrVZpmmQlfonhQUvTR7lMPtO7NkZMkA0ABN3PHCbKA5nqylQ/yWlFAyY6hYgdF1Qh6nYiuADWwKB4C2WSw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        // --- Mobile Menu Toggle ---
        // (Keep this separate - it's simple and self-contained)
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const navMenu = document.getElementById('navMenu');
        const body = document.body;

        if (mobileMenuBtn && navMenu) {
            mobileMenuBtn.addEventListener('click', () => {
                const isExpanded = navMenu.classList.toggle('active');
                mobileMenuBtn.setAttribute('aria-expanded', isExpanded);
                const icon = mobileMenuBtn.querySelector('i');
                if (icon) {
                    icon.className = isExpanded ? 'fas fa-times' : 'fas fa-bars';
                }
                body.classList.toggle('no-scroll', isExpanded);
            });

            // Close menu on link click (for SPA-like behavior or same-page links)
            navMenu.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', () => {
                    if (navMenu.classList.contains('active')) {
                        navMenu.classList.remove('active');
                        mobileMenuBtn.setAttribute('aria-expanded', 'false');
                        const icon = mobileMenuBtn.querySelector('i');
                        if (icon) {
                            icon.className = 'fas fa-bars';
                        }
                        body.classList.remove('no-scroll');
                    }
                });
            });
        }

        // --- Budget Planner Logic ---
        // Wrap all budget planner logic in DOMContentLoaded to ensure HTML is ready
        document.addEventListener('DOMContentLoaded', () => {
            const budgetForm = document.getElementById('budgetForm');
            const summarySection = document.getElementById('summarySection');
            const calculateBtn = document.getElementById('calculateBtn');
            const resetBtn = document.getElementById('resetBtn');
            const sampleDataBtn = document.getElementById('sampleDataBtn');
            const saveLocalBtn = document.getElementById('saveLocalBtn');
            const printBtn = document.getElementById('printBtn');

            // Ensure elements exist before proceeding
            if (!budgetForm || !summarySection || !calculateBtn || !resetBtn || !sampleDataBtn || !saveLocalBtn || !printBtn) {
                console.error("Budget Planner Error: One or more essential elements not found!");
                return; // Stop execution if critical elements are missing
            }

            let incomeExpensesChart = null;
            let expensesChart = null;

            const categoryDetails = {
                income: { totalEl: document.getElementById('incomeTotal'), itemsEl: document.getElementById('incomeCustomItems'), customFieldEl: document.getElementById('incomeCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="income"]') },
                housing: { totalEl: document.getElementById('housingTotal'), itemsEl: document.getElementById('housingCustomItems'), customFieldEl: document.getElementById('housingCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="housing"]') },
                utilities: { totalEl: document.getElementById('utilitiesTotal'), itemsEl: document.getElementById('utilitiesCustomItems'), customFieldEl: document.getElementById('utilitiesCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="utilities"]') },
                food: { totalEl: document.getElementById('foodTotal'), itemsEl: document.getElementById('foodCustomItems'), customFieldEl: document.getElementById('foodCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="food"]') },
                transport: { totalEl: document.getElementById('transportTotal'), itemsEl: document.getElementById('transportCustomItems'), customFieldEl: document.getElementById('transportCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="transport"]') },
                debt: { totalEl: document.getElementById('debtTotal'), itemsEl: document.getElementById('debtCustomItems'), customFieldEl: document.getElementById('debtCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="debt"]') },
                personal: { totalEl: document.getElementById('personalTotal'), itemsEl: document.getElementById('personalCustomItems'), customFieldEl: document.getElementById('personalCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="personal"]') },
                savings: { totalEl: document.getElementById('savingsTotal'), itemsEl: document.getElementById('savingsCustomItems'), customFieldEl: document.getElementById('savingsCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="savings"]') },
                entertainment: { totalEl: document.getElementById('entertainmentTotal'), itemsEl: document.getElementById('entertainmentCustomItems'), customFieldEl: document.getElementById('entertainmentCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="entertainment"]') },
                miscellaneous: { totalEl: document.getElementById('miscTotal'), itemsEl: document.getElementById('miscCustomItems'), customFieldEl: document.getElementById('miscCustomField'), addBtnEl: document.querySelector('.add-item-btn[data-category="miscellaneous"]') }
            };

            // --- Formatting Helper ---
            const formatCurrency = (value) => {
                const numValue = parseFloat(value) || 0;
                // Format with commas and 2 decimal places
                return `R${numValue.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}`;
            };

            // --- Calculate Section Total ---
            const calculateSectionTotal = (category) => {
                const section = budgetForm.querySelector(`.budget-section[data-category="${category}"]`);
                if (!section) return 0;

                const inputs = section.querySelectorAll('.budget-input');
                let total = 0;
                inputs.forEach(input => {
                    total += parseFloat(input.value) || 0;
                });

                // Update the section total display
                if (categoryDetails[category] && categoryDetails[category].totalEl) {
                    categoryDetails[category].totalEl.textContent = formatCurrency(total);
                }
                return total;
            };

            // --- Calculate Overall Budget ---
            const calculateBudget = () => {
                 console.log("Calculating budget..."); // Debug log
                let totalIncome = 0;
                let totalExpenses = 0;
                const expenseBreakdown = {};
                const expenseColors = []; // Store colors in order

                // Calculate income
                totalIncome = calculateSectionTotal('income');

                // Get computed style once for efficiency
                const computedStyle = getComputedStyle(document.documentElement);

                // Calculate expenses and breakdown
                Object.keys(categoryDetails).forEach(category => {
                    if (category !== 'income') {
                        const sectionTotal = calculateSectionTotal(category);
                        totalExpenses += sectionTotal;
                        if (sectionTotal > 0) {
                             // Get category name from title (more robustly)
                             const titleEl = budgetForm.querySelector(`.budget-section[data-category="${category}"] .budget-section-title`);
                             // Extract text content, removing the icon if present
                             const categoryName = titleEl ? titleEl.innerText.trim() : category;
                             expenseBreakdown[categoryName] = sectionTotal;

                             // Get color for the chart
                             const colorVar = `--${category}`;
                              expenseColors.push(computedStyle.getPropertyValue(colorVar).trim() || '#6c757d'); // Fallback color
                         }
                    }
                });

                const balance = totalIncome - totalExpenses;

                // Update Summary Display
                document.getElementById('summaryIncome').textContent = formatCurrency(totalIncome);
                document.getElementById('summaryExpenses').textContent = formatCurrency(totalExpenses);
                const balanceEl = document.getElementById('summaryBalance');
                balanceEl.textContent = formatCurrency(balance);
                balanceEl.classList.remove('positive', 'negative', 'neutral');
                if (balance > 0) balanceEl.classList.add('positive');
                else if (balance < 0) balanceEl.classList.add('negative');
                else balanceEl.classList.add('neutral');

                 console.log("Income:", totalIncome, "Expenses:", totalExpenses, "Balance:", balance); // Debug log
                 console.log("Expense Breakdown:", expenseBreakdown); // Debug log

                // Update Charts
                updateIncomeExpensesChart(totalIncome, totalExpenses);
                updateExpensesChart(expenseBreakdown, expenseColors); // Pass colors

                // Show the summary section
                summarySection.style.display = 'block';

                 console.log("Summary section displayed."); // Debug log
            };

             // --- Update Income vs Expenses Chart ---
            const updateIncomeExpensesChart = (income, expenses) => {
                 const canvas = document.getElementById('incomeExpensesChart');
                 if (!canvas) {
                     console.error("Income/Expenses chart canvas not found!");
                     return;
                 }
                 const ctx = canvas.getContext('2d');
                 const data = {
                    labels: ['Total Income', 'Total Expenses'],
                    datasets: [{
                        label: 'Amount (R)',
                        data: [income, expenses],
                        backgroundColor: [
                            'rgba(0, 188, 140, 0.7)', // --secondary with opacity
                            'rgba(220, 53, 69, 0.7)'  // --debt with opacity
                        ],
                        borderColor: [
                            'rgb(0, 188, 140)',
                            'rgb(220, 53, 69)'
                        ],
                        borderWidth: 1
                    }]
                };

                if (incomeExpensesChart) {
                    incomeExpensesChart.data = data;
                    incomeExpensesChart.update();
                     console.log("Income/Expenses chart updated."); // Debug log
                } else {
                    incomeExpensesChart = new Chart(ctx, {
                        type: 'bar',
                        data: data,
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            legend: { display: false },
                            title: { display: false },
                            scales: {
                                yAxes: [{
                                    ticks: {
                                        beginAtZero: true,
                                        callback: function(value) { return formatCurrency(value); }
                                    }
                                }]
                            },
                            tooltips: {
                                callbacks: {
                                    label: function(tooltipItem, data) {
                                        let label = data.datasets[tooltipItem.datasetIndex].label || '';
                                        if (label) { label += ': '; }
                                        label += formatCurrency(tooltipItem.yLabel);
                                        return label;
                                    }
                                }
                            }
                        }
                    });
                    console.log("Income/Expenses chart created."); // Debug log
                }
            };

            // --- Update Expenses Breakdown Chart ---
             const updateExpensesChart = (expenseData, backgroundColors) => {
                 const canvas = document.getElementById('expensesChart');
                 if (!canvas) {
                     console.error("Expenses chart canvas not found!");
                     return;
                 }
                 const ctx = canvas.getContext('2d');
                 const labels = Object.keys(expenseData);
                 const dataValues = Object.values(expenseData);

                 const data = {
                     labels: labels,
                     datasets: [{
                         label: 'Expense Amount (R)',
                         data: dataValues,
                         backgroundColor: backgroundColors, // Use provided colors
                         borderWidth: 1
                     }]
                 };

                 if (expensesChart) {
                     expensesChart.data = data;
                     expensesChart.update();
                     console.log("Expenses chart updated."); // Debug log
                 } else {
                     expensesChart = new Chart(ctx, {
                         type: 'doughnut', // Or 'pie'
                         data: data,
                         options: {
                             responsive: true,
                             maintainAspectRatio: false,
                             legend: {
                                 position: 'bottom',
                                 labels: { padding: 15 }
                             },
                             title: { display: false },
                             tooltips: {
                                 callbacks: {
                                     label: function(tooltipItem, data) {
                                         const dataset = data.datasets[tooltipItem.datasetIndex];
                                         const total = dataset.data.reduce((acc, value) => acc + value, 0);
                                         const currentValue = dataset.data[tooltipItem.index];
                                         const percentage = total ? Math.round((currentValue / total) * 100) : 0;
                                         let label = data.labels[tooltipItem.index] || '';
                                         if (label) { label += ': '; }
                                         label += formatCurrency(currentValue) + ` (${percentage}%)`;
                                         return label;
                                     }
                                 }
                             }
                         }
                     });
                     console.log("Expenses chart created."); // Debug log
                 }
             };

             // --- Add Custom Item ---
            const addCustomItem = (category, name, value) => {
                // Ensure category details exist
                if (!categoryDetails[category]) {
                    console.error(`Invalid category "${category}" for adding custom item.`);
                    return;
                }
                 const { itemsEl, customFieldEl, addBtnEl } = categoryDetails[category];
                 if (!itemsEl || !name || value < 0) {
                     console.warn("Custom item validation failed (missing container, name, or invalid value).");
                     return;
                 }

                 const valueNum = parseFloat(value) || 0;
                 const uniqueId = `${category}-custom-${Date.now()}`; // Simple unique ID

                 const newItem = document.createElement('div');
                 newItem.classList.add('added-item');
                 newItem.dataset.itemId = uniqueId; // Add dataset for easier selection if needed
                 newItem.innerHTML = `
                     <span class="added-item-name">${name}</span>
                     <span class="added-item-value">${formatCurrency(valueNum)}</span>
                     <input type="hidden" class="budget-input custom-input ${category}-input" value="${valueNum}" data-item-name="${name}" data-custom-id="${uniqueId}">
                     <button type="button" class="delete-item" aria-label="Delete ${name}"><i class="fas fa-trash-alt"></i></button>
                 `;

                 itemsEl.appendChild(newItem);
                 console.log(`Added custom item "${name}" to ${category}.`); // Debug log

                 // Add listener to the new delete button
                 newItem.querySelector('.delete-item').addEventListener('click', () => {
                     newItem.remove();
                     console.log(`Deleted custom item "${name}" from ${category}.`); // Debug log
                     calculateBudget(); // Recalculate after deleting
                 });

                 // Clear and hide the custom input fields
                 if (customFieldEl) {
                     customFieldEl.querySelector('input[type="text"]').value = '';
                     customFieldEl.querySelector('.custom-value-input').value = ''; // Use class selector
                     customFieldEl.classList.remove('active');
                 }
                 // Show the 'Add Item' button again
                  if (addBtnEl) {
                    addBtnEl.style.display = 'flex';
                  }

                 // Recalculate after adding (important!)
                 calculateBudget();
             };


             // --- Event Listeners ---

             // Calculate button click
             calculateBtn.addEventListener('click', calculateBudget);

            // Add Item button click (Show custom field)
            budgetForm.querySelectorAll('.add-item-btn').forEach(button => {
                 button.addEventListener('click', () => {
                     const category = button.dataset.category;
                      if (!categoryDetails[category]) return; // Safety check
                     const { customFieldEl, addBtnEl } = categoryDetails[category];
                     if (customFieldEl) {
                         customFieldEl.classList.add('active');
                         customFieldEl.querySelector('input[type="text"]').focus();
                         if(addBtnEl) addBtnEl.style.display = 'none'; // Hide 'Add' button
                     }
                 });
             });

             // Cancel Custom Item button click
            budgetForm.querySelectorAll('.cancel-custom-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const container = button.closest('.custom-field-container');
                    if (!container) return; // Safety check

                    // Extract category robustly (handle potential ID changes)
                    const section = container.closest('.budget-section');
                    const category = section ? section.dataset.category : null;

                    if (category && categoryDetails[category]) {
                        const { addBtnEl } = categoryDetails[category];
                        container.classList.remove('active');
                        container.querySelector('input[type="text"]').value = '';
                        container.querySelector('.custom-value-input').value = ''; // Use class selector
                        if (addBtnEl) addBtnEl.style.display = 'flex'; // Show 'Add' button again
                    } else {
                        console.error("Could not find category for cancel button.");
                        // Fallback: Just hide the container
                        container.classList.remove('active');
                    }
                });
            });


            // Add Custom Item button click (inside the custom field container)
            budgetForm.querySelectorAll('.add-custom-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const container = button.closest('.custom-field-container');
                     if (!container) return; // Safety check

                     // Extract category robustly
                     const section = container.closest('.budget-section');
                     const category = section ? section.dataset.category : null;

                    if (category) {
                        const nameInput = container.querySelector('input[type="text"]');
                        const valueInput = container.querySelector('.custom-value-input'); // Use class selector

                        if (nameInput && valueInput) {
                           addCustomItem(category, nameInput.value.trim(), valueInput.value);
                        } else {
                            console.error("Name or value input not found in custom field container for category:", category);
                        }
                    } else {
                         console.error("Could not find category for add custom button.");
                    }
                });
            });


            // Delegate event listener for dynamically added delete buttons
            budgetForm.addEventListener('click', (e) => {
                 // Check if the clicked element or its parent is a delete button
                 const deleteButton = e.target.closest('.delete-item');
                 if (deleteButton) {
                     const item = deleteButton.closest('.added-item');
                     if (item) {
                         const itemName = item.querySelector('.added-item-name')?.textContent || 'Unknown Item';
                         item.remove();
                         console.log(`Deleted custom item "${itemName}" via delegated listener.`); // Debug log
                         calculateBudget(); // Recalculate after deleting
                     }
                 }
             });

              // --- Reset Form ---
             resetBtn.addEventListener('click', () => {
                 if (confirm('Are you sure you want to reset the budget form? All data will be lost.')) {
                     budgetForm.reset(); // Resets standard inputs
                     // Clear custom items
                     budgetForm.querySelectorAll('.added-items').forEach(el => el.innerHTML = '');
                     // Hide custom input fields and show add buttons
                     Object.values(categoryDetails).forEach(detail => {
                         if (detail.customFieldEl) detail.customFieldEl.classList.remove('active');
                         if (detail.addBtnEl) detail.addBtnEl.style.display = 'flex';
                         if (detail.totalEl) detail.totalEl.textContent = formatCurrency(0); // Reset section totals display
                     });

                     // Reset summary display and hide section
                     document.getElementById('summaryIncome').textContent = formatCurrency(0);
                     document.getElementById('summaryExpenses').textContent = formatCurrency(0);
                     document.getElementById('summaryBalance').textContent = formatCurrency(0);
                     summarySection.style.display = 'none'; // Hide summary

                     // Destroy existing charts
                     if (incomeExpensesChart) {
                         incomeExpensesChart.destroy();
                         incomeExpensesChart = null;
                     }
                     if (expensesChart) {
                         expensesChart.destroy();
                         expensesChart = null;
                     }

                     localStorage.removeItem('budgetPlannerData'); // Clear saved data
                     console.log("Budget reset completed.");
                 }
             });

             // --- Load Sample Data ---
             sampleDataBtn.addEventListener('click', () => {
                 if (confirm('Load sample data? This will overwrite current entries.')) {
                     // Reset the form completely before loading sample data
                     resetBtn.click(); // Trigger the reset logic
                      // We need a slight delay for the reset to fully complete DOM changes before adding new items
                      setTimeout(() => {
                        const sample = {
                            salary: 25000, sideJobs: 1500,
                            rent: 7500, propertyRates: 600, homeInsurance: 350, repairs: 200,
                            electricity: 1200, water: 450, refuse: 150, internet: 650, cellPhone: 500, television: 300,
                            groceries: 4000, eatingOut: 800, takeaways: 400,
                            carPayment: 3500, fuel: 1800, carInsurance: 900, carMaintenance: 300, publicTransport: 150,
                            personalLoan: 1000, creditCard: 750, storeAccounts: 500,
                            medicalAid: 2200, medicine: 150, clothing: 600, personalCare: 300, childcare: 1500,
                            emergencyFund: 1000, retirementFund: 2000, taxFreeSavings: 500, goalSavings: 300,
                            subscriptions: 200, moviesEvents: 300, hobbies: 250,
                            donations: 100, gifts: 150, unexpected: 200,
                            // Sample custom items
                            income_custom: [{ name: "Rental Unit", value: 3000 }],
                            housing_custom: [{ name: "Levies", value: 1100 }],
                            utilities_custom: [{ name: "Garden Service", value: 350 }],
                            personal_custom: [{ name: "Gym Membership", value: 450 }],
                            savings_custom: [{ name: "Holiday Fund", value: 700 }],
                        };

                        Object.keys(sample).forEach(key => {
                            if (key.endsWith('_custom')) {
                                const category = key.split('_')[0];
                                if (categoryDetails[category]) { // Check if category exists
                                    sample[key].forEach(item => addCustomItem(category, item.name, item.value));
                                }
                            } else {
                                const input = document.getElementById(key);
                                if (input) {
                                    input.value = sample[key];
                                }
                            }
                        });
                        // IMPORTANT: Calculate budget AFTER setting all values and adding items
                        calculateBudget();
                        console.log("Sample data loaded and budget calculated.");
                     }, 100); // 100ms delay, adjust if needed
                 }
             });


             // --- Save/Load Budget to Local Storage ---
             saveLocalBtn.addEventListener('click', () => {
                 const budgetData = {};
                 // Get standard input values
                 budgetForm.querySelectorAll('.budget-input:not(.custom-input)').forEach(input => {
                     if(input.id && input.value) { // Only save if it has an ID and a value
                         budgetData[input.id] = input.value;
                     }
                 });
                 // Get custom items
                  Object.keys(categoryDetails).forEach(category => {
                     const itemsContainer = categoryDetails[category]?.itemsEl; // Use optional chaining
                     if (itemsContainer) {
                         const customItems = [];
                         itemsContainer.querySelectorAll('.added-item').forEach(itemEl => {
                             const nameEl = itemEl.querySelector('.added-item-name');
                             const inputEl = itemEl.querySelector('.custom-input');
                             if(nameEl && inputEl) {
                                const name = nameEl.textContent;
                                const value = inputEl.value;
                                customItems.push({ name, value });
                             }
                         });
                         if (customItems.length > 0) {
                             budgetData[`${category}_custom`] = customItems;
                         }
                     }
                 });

                 if (Object.keys(budgetData).length > 0) {
                      try {
                         localStorage.setItem('budgetPlannerData', JSON.stringify(budgetData));
                         alert('Budget saved successfully to your browser!');
                          console.log("Budget saved locally:", budgetData);
                     } catch (e) {
                         console.error("Error saving to local storage:", e);
                         alert('Error saving budget. Local storage might be full or disabled.');
                     }
                 } else {
                     alert('No data entered to save.');
                 }
             });

             const loadLocalData = () => {
                 const savedData = localStorage.getItem('budgetPlannerData');
                 if (savedData) {
                     console.log("Loading saved budget...");
                     // Don't reset here, let the load overwrite fields and add custom items
                     try {
                         const budgetData = JSON.parse(savedData);
                          // Clear existing custom items before loading saved ones
                          budgetForm.querySelectorAll('.added-items').forEach(el => el.innerHTML = '');

                         Object.keys(budgetData).forEach(key => {
                             if (key.endsWith('_custom')) {
                                 const category = key.split('_')[0];
                                  if (categoryDetails[category]) { // Check if category exists
                                     budgetData[key].forEach(item => addCustomItem(category, item.name, item.value));
                                  }
                             } else {
                                 const input = document.getElementById(key);
                                 if (input) {
                                     input.value = budgetData[key];
                                 }
                             }
                         });
                         // IMPORTANT: Calculate budget AFTER setting all values and adding items
                         calculateBudget();
                         console.log("Budget loaded and calculated successfully.");
                     } catch (e) {
                         console.error("Error parsing saved data:", e);
                         localStorage.removeItem('budgetPlannerData'); // Clear corrupted data
                         alert('Could not load saved budget. Data might be corrupted. Resetting form.');
                         resetBtn.click(); // Reset if loading failed
                     }
                 } else {
                     console.log("No saved budget found. Initializing empty form.");
                     // Optionally calculate empty budget on initial load if desired
                     // calculateBudget();
                 }
             };

             // --- Print/Export Budget ---
             printBtn.addEventListener('click', () => {
                 if (typeof html2pdf === 'undefined') {
                      console.warn('html2pdf library not found. Using standard window.print().');
                      window.print(); // Fallback to browser print
                      return;
                  }

                 // Ensure latest calculations are done and visible
                 calculateBudget();

                 // Give charts a moment to render fully before PDF generation
                 setTimeout(() => {
                    alert("Preparing PDF. This might take a moment...");

                    const elementToPrint = document.createElement('div');

                    // Clone essential parts
                    const headerClone = document.querySelector('.page-header').cloneNode(true);
                    const formClone = budgetForm.cloneNode(true);
                    const summaryClone = summarySection.style.display !== 'none' ? summarySection.cloneNode(true) : null; // Only clone summary if visible

                    // Clean up clones for printing (remove interactive elements)
                    formClone.querySelectorAll('.add-item-btn, .custom-field-container, .delete-item').forEach(el => el.remove());
                    if(summaryClone) {
                        summaryClone.querySelectorAll('.budget-actions').forEach(el => el.remove()); // Remove recalculate button
                    }

                    elementToPrint.appendChild(headerClone);
                    elementToPrint.appendChild(formClone);
                    if (summaryClone) {
                        elementToPrint.appendChild(summaryClone);
                    }

                    const opt = {
                        margin:       [0.5, 0.5, 0.5, 0.5], // inches [top, left, bottom, right]
                        filename:     'My-Budget-FinancialCompass.pdf',
                        image:        { type: 'jpeg', quality: 0.98 },
                        html2canvas:  { scale: 2, useCORS: true, logging: false, scrollY: -window.scrollY }, // Try to capture current view
                        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' },
                        pagebreak:    { mode: ['avoid-all', '.budget-section', '.summary-grid', '.charts-container', '.tip-card'] } // Avoid breaks within these elements
                    };

                    html2pdf().set(opt).from(elementToPrint).save()
                        .then(() => {
                            console.log('PDF generated successfully.');
                        })
                        .catch(err => {
                            console.error("Error generating PDF with html2pdf:", err);
                            alert('Could not generate PDF. Using browser print as fallback.');
                            window.print(); // Fallback print
                        });
                 }, 500); // 500ms delay for rendering, adjust if needed
             });

             // --- Initial Load ---
             loadLocalData(); // Load any saved data when the page loads

             console.log("Budget Planner Initialized."); // Final debug log

        }); // End of DOMContentLoaded listener

        // --- Footer Year (Keep separate and simple) ---
        const currentYearSpan = document.getElementById('currentYear');
        if (currentYearSpan) {
            currentYearSpan.textContent = new Date().getFullYear();
        } else {
             console.warn("Footer year span ('currentYear') not found.");
        }

    </script>

</body>
</html>
