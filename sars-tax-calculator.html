<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Your Money: Your SARS Tax Navigator | Financial Compass</title>
    <meta name="description" content="Free South African SARS income tax calculator for 2025/2026. Accurately calculate your tax liability and take-home pay with the latest tax brackets, rebates, and medical aid credits.">

    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <link rel="icon" href="favicon.ico" sizes="any">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@700&display=swap" rel="stylesheet">


    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        /* --- Base Styles --- */
        :root {
            --primary: #0070D1; /* Blue */
            --primary-dark: #005bb1;
            --secondary: #00BC8C; /* Teal/Green */
            --secondary-dark: #009670;
            --accent: #FFC107; /* Yellow/Gold */
            --accent-dark: #e6ac00;
            --text: #333333;
            --text-light: #666666;
            --background: #FFFFFF;
            --background-alt: #F9FBFD; /* Very light blue/grey */
            --border: #E1E8ED;
            --shadow: rgba(0, 0, 0, 0.05);
            --radius: 10px;
            --input-bg: #F5F8FA;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --highlight-bg: #e6f7ff; /* Light blue for highlighting results */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            color: var(--text);
            line-height: 1.6;
            background-color: var(--background);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        body.no-scroll {
            overflow: hidden;
        }

        a {
            text-decoration: none;
            color: var(--primary);
            transition: color 0.3s;
        }

        a:hover {
            color: var(--primary-dark);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        img {
             max-width: 100%;
             height: auto;
             display: block;
        }

        /* --- Buttons --- */
        .btn {
            display: inline-block;
            padding: 12px 28px;
            background-color: var(--primary);
            color: white;
            border-radius: var(--radius);
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            text-align: center;
            font-size: 1rem;
        }

        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 112, 209, 0.2);
        }
        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }


        .btn-secondary {
            background-color: var(--secondary);
        }

        .btn-secondary:hover {
            background-color: var(--secondary-dark);
            box-shadow: 0 4px 12px rgba(0, 188, 140, 0.2);
        }

        .btn-accent {
            background-color: var(--accent);
            color: #333;
        }

        .btn-accent:hover {
            background-color: var(--accent-dark);
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.2);
        }

        .btn-outline {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background-color: var(--primary);
            color: white;
        }

        .btn-full {
            width: 100%;
        }

        /* --- Sections & Titles --- */
        .section {
            padding: 60px 0;
        }

        .section-title {
            font-size: 2.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
            color: var(--text);
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-light);
            text-align: center;
            max-width: 700px;
            margin: 0 auto 3rem;
        }

        /* --- Cards --- */
        .card {
            background-color: var(--background);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 6px 18px var(--shadow);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border);
        }

        .card-padding {
            padding: 24px;
        }

        /* --- Form Elements --- */
        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text);
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background-color: var(--input-bg);
            transition: all 0.3s ease;
            font-size: 1rem;
            font-family: inherit;
        }

        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 112, 209, 0.1);
            outline: none;
        }

        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background-color: var(--input-bg);
            font-size: 1rem;
            font-family: inherit;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23333333' width='18px' height='18px'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3Cpath d='M0 0h24v24H0z' fill='none'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
        }

        .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 112, 209, 0.1);
            outline: none;
        }

        .input-group {
            position: relative;
        }

        .input-group .currency-symbol {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-weight: 500;
            pointer-events: none;
        }

        .input-group .form-input {
            padding-left: 32px;
        }

        .tooltip {
            display: inline-block;
            margin-left: 6px;
            position: relative;
            cursor: help;
        }

        .tooltip-icon {
            color: var(--primary);
            font-size: 0.85rem;
        }

        .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 16px;
        }

        .checkbox-container input[type="checkbox"] {
            margin-right: 10px;
            width: 18px;
            height: 18px;
            accent-color: var(--primary);
        }

        /* --- Page-specific styles --- */
        .page-header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 50px 0;
            text-align: center;
        }

        .page-title {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
        }

        .page-description {
            max-width: 700px;
            margin: 0 auto;
            font-size: 1.15rem;
            opacity: 0.95;
        }

        /* Calculator layout */
        .calculator-container {
            display: grid;
            grid-template-columns: 1fr 1.1fr; /* Form on left, main results on right */
            gap: 40px;
            margin-bottom: 40px; /* Space before full-width sections */
        }

        .calculator-results {
            background-color: var(--background-alt);
        }
        
        .result-section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--primary-dark);
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary);
            display: inline-block;
        }

        .result-summary {
            padding: 20px;
            margin-bottom: 20px;
            border-radius: var(--radius);
            background-color: var(--highlight-bg);
            text-align: center;
            border: 1px solid var(--primary);
        }

        .result-summary .result-label-main {
            font-size: 1rem;
            color: var(--primary-dark);
            margin-bottom: 4px;
            font-weight: 500;
        }
        .result-summary .result-value-main {
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
        }

        .take-home-summary {
            padding: 20px;
            margin-top: 20px;
            margin-bottom: 20px;
            border-radius: var(--radius);
            background-color: var(--secondary);
            color: white;
            text-align: center;
            border: 1px solid var(--secondary-dark);
        }
        .take-home-summary .result-label-main {
            font-size: 1rem;
            color: rgba(255,255,255,0.9);
            margin-bottom: 4px;
            font-weight: 500;
        }
         .take-home-summary .result-value-main {
            font-size: 2.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 8px;
        }

        .result-detail {
            font-size: 1rem;
            color: var(--text-light);
        }

        .result-heading { 
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text);
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.95rem;
        }

        .result-row:last-child {
            border-bottom: none;
        }

        .result-label { /* Applied to the div containing the label text */
            font-weight: 500;
            color: var(--text-light);
        }

        .result-value {
            font-weight: 600;
            color: var(--text);
        }

        /* Full-width sections styling */
        .full-width-card {
            width: 100%;
            margin-top: 30px; 
        }


        .tax-bracket-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px; 
        }

        .tax-bracket-table th,
        .tax-bracket-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        .tax-bracket-table th {
            background-color: var(--background-alt);
            font-weight: 600;
        }

        .tax-bracket-current {
            background-color: rgba(0, 112, 209, 0.1);
            font-weight: 600;
        }

        .chart-container { 
            position: relative;
            height: 350px;
        }

        .info-box {
            background-color: rgba(0, 112, 209, 0.05);
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin-bottom: 24px;
            border-radius: 0 var(--radius) var(--radius) 0;
        }

        .info-box-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--primary);
            font-size: 1.1rem;
        }

        .tax-year-selector {
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
        }

        .tax-year-btn {
            padding: 10px 22px;
            background-color: var(--background-alt);
            border: 1px solid var(--border);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .tax-year-btn:first-child {
            border-radius: var(--radius) 0 0 var(--radius);
        }

        .tax-year-btn:last-child {
            border-radius: 0 var(--radius) var(--radius) 0;
        }

        .tax-year-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(0, 112, 209, 0.15);
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            margin-top: 30px;
        }
        #calculateBtn {
            background-color: var(--secondary);
            font-weight: 600;
        }
        #calculateBtn:hover {
            background-color: var(--secondary-dark);
            box-shadow: 0 4px 12px rgba(0, 188, 140, 0.3);
        }

        .period-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .period-toggle label {
            padding: 8px 15px;
            background-color: var(--background);
            border: 1px solid var(--border);
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            user-select: none;
        }

        .period-toggle label:first-of-type {
            border-radius: var(--radius) 0 0 var(--radius);
            border-right: none;
        }

        .period-toggle label:last-of-type {
            border-radius: 0 var(--radius) var(--radius) 0;
        }

        .period-toggle input[type="radio"] {
            display: none;
        }

        .period-toggle input[type="radio"]:checked + label {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

         .income-period-toggle {
             display: flex;
             margin-bottom: 10px;
         }

         .income-period-toggle label {
             flex-grow: 1;
             text-align: center;
             padding: 8px 10px;
             background-color: var(--background-alt);
             border: 1px solid var(--border);
             cursor: pointer;
             font-weight: 500;
             transition: all 0.3s ease;
             user-select: none;
         }

         .income-period-toggle label:first-of-type {
             border-radius: var(--radius) 0 0 var(--radius);
             border-right: none;
         }

         .income-period-toggle label:last-of-type {
             border-radius: 0 var(--radius) var(--radius) 0;
         }

         .income-period-toggle input[type="radio"] {
             display: none;
         }

         .income-period-toggle input[type="radio"]:checked + label {
             background-color: var(--secondary);
             color: white;
             border-color: var(--secondary);
         }

        .strategies-section {
             background-color: var(--background-alt);
        }

        .strategies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 40px;
        }

        .strategy-card .card-padding {
            padding: 20px;
        }

        .strategy-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--primary);
        }

        .strategy-description {
            color: var(--text-light);
            font-size: 0.95rem;
        }

        .wisdom-nugget-section-inner { /* Renamed to avoid conflict, used for specific styling */
            background-color: #fffbeb; 
            border-left: 5px solid var(--accent);
            border-radius: var(--radius); 
            padding: 20px; /* Added padding here for the inner content */
        }
        .wisdom-nugget-title {
            font-family: 'Caveat', cursive;
            font-size: 2rem; /* Increased size */
            color: var(--accent-dark);
            margin-bottom: 12px; /* Adjusted margin */
        }
        .wisdom-nugget-text {
            font-size: 1.1rem; /* Increased size */
            color: var(--text-light);
            line-height: 1.6; /* Adjusted line height */
        }


        header {
            background-color: var(--background);
            box-shadow: 0 2px 10px var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            width: 100%;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            height: 73px;
        }

        .logo {
            display: flex;
            align-items: center;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--text);
        }

        .logo i {
            color: var(--primary);
            margin-right: 10px;
            font-size: 1.8rem;
        }

        .logo span {
             color: var(--primary);
        }

        .nav-menu {
            display: flex;
            list-style: none;
        }

        .nav-item {
            margin-left: 28px;
        }

        .nav-link {
            color: var(--text);
            font-weight: 500;
            padding: 8px 4px;
            position: relative;
            font-size: 1rem;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 2px;
            background-color: var(--primary);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after,
        .nav-link.active::after {
             width: 100%;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text);
            padding: 5px;
        }

        footer {
            background-color: #1e293b;
            color: rgba(255, 255, 255, 0.8);
            padding: 64px 0 32px;
            font-size: 0.95rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 48px;
            margin-bottom: 48px;
        }

        .footer-column.about .footer-logo {
             color: white;
             font-size: 1.6rem;
             margin-bottom: 16px;
             display: inline-flex;
             align-items: center;
        }
        .footer-column.about .footer-logo i {
             color: var(--primary);
             margin-right: 10px;
        }

        .footer-description {
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 24px;
            line-height: 1.7;
        }

        .footer-social {
            display: flex;
            gap: 12px;
        }

        .footer-social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .footer-social-link:hover {
            background-color: var(--primary);
            transform: translateY(-3px);
        }

        .footer-heading {
            font-size: 1.15rem;
            font-weight: 600;
            margin-bottom: 24px;
            color: white;
        }

        .footer-links {
            list-style: none;
            padding: 0;
        }

        .footer-link {
            margin-bottom: 12px;
        }

        .footer-link a {
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
        }

        .footer-link a:hover {
            color: white;
            padding-left: 5px;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.15);
            padding-top: 32px;
            margin-top: 16px;
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.875rem;
        }

        .faq-section {
            background-color: var(--background-alt);
        }

        .faq-item {
            margin-bottom: 24px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            background-color: var(--background);
        }

        .faq-question {
            padding: 20px;
            background-color: var(--background);
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .faq-question:hover {
            background-color: rgba(0, 112, 209, 0.05);
        }

        .faq-question i {
            transition: transform 0.3s ease;
        }

        .faq-answer {
            padding: 0 20px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, padding 0.3s ease;
        }

        .faq-item.active .faq-question {
            background-color: rgba(0, 112, 209, 0.1);
        }

        .faq-item.active .faq-question i {
            transform: rotate(180deg);
        }

        .faq-item.active .faq-answer {
            padding: 20px;
            max-height: 500px;
            border-top: 1px solid var(--border);
        }

        @media (max-width: 992px) {
            .calculator-container {
                grid-template-columns: 1fr; 
            }
            .calculator-results {
                margin-top: 30px;
            }

            .nav-menu {
                position: fixed;
                top: 73px;
                left: -100%;
                flex-direction: column;
                background-color: var(--background);
                width: 100%;
                height: calc(100vh - 73px);
                transition: left 0.3s ease-in-out;
                box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
                padding: 20px 0;
                overflow-y: auto;
                z-index: 999;
             }

             .nav-menu.active {
                left: 0;
             }

             .nav-item {
                margin: 0;
                width: 100%;
             }

             .nav-link {
                 display: block;
                 padding: 16px 30px;
                 text-align: left;
                 border-bottom: 1px solid var(--border);
                 font-size: 1.1rem;
             }

             .nav-link:hover {
                 background-color: var(--background-alt);
             }

             .nav-link::after {
                 display: none;
             }

             .nav-item:last-child .nav-link {
                 border-bottom: none;
             }

             .mobile-menu-btn {
                 display: block;
             }
         }

        @media (max-width: 768px) {
            .section {
                padding: 40px 0;
            }

            .page-header {
                padding: 30px 0;
            }

            .page-title {
                font-size: 2.2rem;
            }

            .section-title {
                font-size: 1.75rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }

            .footer-column {
                 display: flex;
                 flex-direction: column;
                 align-items: center;
            }

            .footer-column.about .footer-logo {
                 justify-content: center;
            }

            .footer-social {
                 justify-content: center;
            }

            .footer-links {
                 text-align: center;
            }
        }

        @media (max-width: 576px) {
            .page-title {
                font-size: 1.9rem;
            }

            .page-description {
                font-size: 1rem;
            }
            .result-summary .result-value-main,
            .take-home-summary .result-value-main {
                font-size: 2.2rem;
            }


            .header-container {
                padding: 12px 0;
                height: 65px;
            }

            .nav-menu {
                top: 65px;
                height: calc(100vh - 65px);
            }

            .logo {
                font-size: 1.4rem;
            }

            .logo i {
                font-size: 1.6rem;
            }

            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
             .income-period-toggle label {
                 padding: 8px 5px;
                 font-size: 0.9rem;
             }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-container">
            <a href="/" class="logo">
                <i class="fas fa-compass"></i> Financial<span>Compass</span>
            </a>

            <nav>
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Open Menu" aria-expanded="false" aria-controls="navMenu">
                    <i class="fas fa-bars"></i>
                </button>
                <ul class="nav-menu" id="navMenu">
                    <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                    <li class="nav-item"><a href="/#tools" class="nav-link active">Financial Tools</a></li>
                    <li class="nav-item"><a href="/#about" class="nav-link">Why Us</a></li>
                    <li class="nav-item"><a href="/#updates" class="nav-link">Updates</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="page-header">
        <div class="container">
            <h1 class="page-title">Map Your Money: Your SARS Tax Navigator</h1>
            <p class="page-description">Understand your South African income tax for 2025/2026. Calculate your tax liability, discover your take-home pay, and get insights with our easy-to-use tool.</p>
        </div>
    </div>

    <section class="section">
        <div class="container"> 
            <div class="tax-year-selector">
                <button class="tax-year-btn active" data-year="2025">2025/2026</button>
                <button class="tax-year-btn" data-year="2024">2024/2025</button>
                <button class="tax-year-btn" data-year="2023">2023/2024</button>
            </div>

            <div class="info-box">
                <h3 class="info-box-title">Latest Tax Updates</h3>
                <p id="taxYearInfoText">The 2025/2026 tax year runs from 1 March 2025 to 28 February 2026. Key updates include adjusted tax brackets and increased primary rebate to R17,235.</p>
            </div>

            <div class="calculator-container">
                <div class="calculator-form card card-padding">
                    <h2 class="result-heading">Enter Your Financial Details</h2>

                    <form id="taxCalculatorForm">
                        <div class="form-group">
                            <label class="form-label" for="ageSelect">Your Age
                                <span class="tooltip">
                                    <i class="fas fa-info-circle tooltip-icon"></i>
                                    <span class="tooltip-text" id="ageTooltipText">Your age at the end of the tax year</span>
                                </span>
                            </label>
                            <select class="form-select" id="ageSelect">
                                <option value="under65">Under 65</option>
                                <option value="65to74">65 to 74</option>
                                <option value="75plus">75 and over</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="incomeInput">Income (Before Tax)
                                <span class="tooltip">
                                    <i class="fas fa-info-circle tooltip-icon"></i>
                                    <span class="tooltip-text" id="incomeTooltipText">Enter your total monthly income before any deductions</span>
                                </span>
                            </label>
                             <div class="income-period-toggle">
                                <input type="radio" id="incomePeriodMonthly" name="incomePeriod" value="monthly" checked>
                                <label for="incomePeriodMonthly">Monthly</label>
                                <input type="radio" id="incomePeriodAnnual" name="incomePeriod" value="annual">
                                <label for="incomePeriodAnnual">Annual</label>
                            </div>
                            <div class="input-group">
                                <span class="currency-symbol">R</span>
                                <input type="number" class="form-input" id="incomeInput" placeholder="0.00" min="0" step="100">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="retirementContributions">Annual Retirement Fund Contributions
                                <span class="tooltip">
                                    <i class="fas fa-info-circle tooltip-icon"></i>
                                    <span class="tooltip-text">Total annual contributions to pension, provident, or retirement annuity funds</span>
                                </span>
                            </label>
                            <div class="input-group">
                                <span class="currency-symbol">R</span>
                                <input type="number" class="form-input" id="retirementContributions" placeholder="0.00" min="0" step="100">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Do you belong to a medical aid scheme?</label>
                            <div class="checkbox-container">
                                <input type="checkbox" id="hasMedicalAid">
                                <label for="hasMedicalAid">Yes, I am a member of a medical scheme</label>
                            </div>

                            <div id="medicalAidSection" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label" for="medicalDependents">Number of dependents (including yourself)
                                        <span class="tooltip">
                                            <i class="fas fa-info-circle tooltip-icon"></i>
                                            <span class="tooltip-text">Total number of people covered by your medical aid</span>
                                        </span>
                                    </label>
                                    <input type="number" class="form-input" id="medicalDependents" placeholder="1" min="1" value="1">
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="monthlyMedicalContributions">Monthly Medical Aid Contributions
                                        <span class="tooltip">
                                            <i class="fas fa-info-circle tooltip-icon"></i>
                                            <span class="tooltip-text">Your monthly contributions to your medical aid scheme</span>
                                        </span>
                                    </label>
                                    <div class="input-group">
                                        <span class="currency-symbol">R</span>
                                        <input type="number" class="form-input" id="monthlyMedicalContributions" placeholder="0.00" min="0" step="10">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="annualMedicalExpenses">Annual Medical Expenses Not Covered by Medical Aid
                                        <span class="tooltip">
                                            <i class="fas fa-info-circle tooltip-icon"></i>
                                            <span class="tooltip-text">Medical expenses paid out of pocket that were not reimbursed by your medical aid</span>
                                        </span>
                                    </label>
                                    <div class="input-group">
                                        <span class="currency-symbol">R</span>
                                        <input type="number" class="form-input" id="annualMedicalExpenses" placeholder="0.00" min="0" step="10">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="action-buttons">
                            <button type="button" id="calculateBtn" class="btn btn-full"><i class="fas fa-calculator"></i> Calculate Tax</button>
                            <button type="reset" id="resetBtn" class="btn btn-outline btn-full"><i class="fas fa-undo"></i> Reset</button>
                        </div>
                    </form>
                </div>

                <div class="calculator-results card card-padding">
                    <h2 class="result-section-title">Your Financial Blueprint</h2>

                    <div class="period-toggle">
                        <input type="radio" id="periodAnnual" name="period" value="annual" checked>
                        <label for="periodAnnual">Annual</label>
                        <input type="radio" id="periodMonthly" name="period" value="monthly">
                        <label for="periodMonthly">Monthly</label>
                    </div>

                    <div class="result-summary">
                        <div class="result-label-main" id="resultPeriodLabel">Estimated Tax Liability</div>
                        <div class="result-value-main" id="totalTaxResult">R0.00</div>
                    </div>

                    <div class="take-home-summary">
                        <div class="result-label-main" id="takeHomePeriodLabel">Estimated Take-Home Pay</div>
                        <div class="result-value-main" id="totalTakeHomeResult">R0.00</div>
                    </div>

                    <h3 class="result-heading">Detailed Breakdown</h3>
                    <div class="result-row">
                        <div class="result-label" id="grossIncomeLabel">Gross Income (Annual):</div>
                        <div class="result-value" id="grossIncomeResult">R0.00</div>
                    </div>
                    <div class="result-row">
                        <div class="result-label" id="retirementDeductionLabel">Retirement Deduction (Annual):</div>
                        <div class="result-value" id="retirementDeductionResult">R0.00</div>
                    </div>
                    <div class="result-row">
                        <div class="result-label" id="taxableIncomeLabel">Taxable Income (Annual):</div>
                        <div class="result-value" id="taxableIncomeResult">R0.00</div>
                    </div>
                    <div class="result-row">
                        <div class="result-label" id="incomeTaxLabel">Income Tax (before rebates, Annual):</div>
                        <div class="result-value" id="incomeTaxResult">R0.00</div>
                    </div>
                    <div class="result-row">
                        <div class="result-label" id="primaryRebateLabel">Primary Rebate (Annual):</div>
                        <div class="result-value" id="primaryRebateResult">R0.00</div>
                    </div>
                    <div class="result-row">
                        <div class="result-label" id="ageRebateLabel">Age Rebate (Annual):</div>
                        <div class="result-value" id="ageRebateResult">R0.00</div>
                    </div>
                    <div class="result-row">
                        <div class="result-label" id="medicalCreditsLabel">Medical Credits (Annual):</div>
                        <div class="result-value" id="medicalCreditsResult">R0.00</div>
                    </div>
                    <div class="result-row" style="font-weight: bold; background-color: #f0f8ff; padding-top:12px; padding-bottom:12px;">
                        <div class="result-label" id="taxPayableDetailLabel">Net Tax Payable (Annual):</div>
                        <div class="result-value" id="taxPayableResult">R0.00</div>
                    </div>
                     <div class="result-row" style="font-weight: bold; background-color: #e6fff9; padding-top:12px; padding-bottom:12px;">
                        <div class="result-label" id="takeHomePayDetailLabel">Net Take-Home Pay (Annual):</div>
                        <div class="result-value" id="takeHomePayResult">R0.00</div>
                    </div>
                </div>
            </div> 

            <div id="wisdomNuggetOuterContainer" class="full-width-card card" style="display:none;">
                <div class="wisdom-nugget-section-inner"> 
                    <h4 class="wisdom-nugget-title">Financial Wisdom Nugget <i class="fas fa-lightbulb" style="color: var(--accent);"></i></h4>
                    <p class="wisdom-nugget-text" id="wisdomNuggetText"></p>
                </div>
            </div>

            <div class="full-width-card card card-padding">
                <h3 class="result-heading" id="incomeJourneyChartTitle">Your Income Journey (Annual)</h3>
                <div class="chart-container">
                    <canvas id="incomeJourneyChart"></canvas>
                </div>
            </div>

            <div class="full-width-card card card-padding">
                <h3 class="result-heading">Your Tax Bracket</h3>
                <table class="tax-bracket-table" id="taxBracketTable">
                    <thead>
                        <tr>
                            <th>Taxable Income</th>
                            <th>Rate of Tax</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>

        </div> 
    </section>

    <section class="section strategies-section" id="tax-strategies">
        <div class="container">
            <h2 class="section-title">Optimise Your Tax: Key Strategies</h2>
            <p class="section-subtitle">Explore legitimate ways to potentially reduce your tax liability in South Africa.</p>
            <div class="strategies-grid">
                <div class="strategy-card card">
                    <div class="card-padding">
                        <h3 class="strategy-title">Maximise Retirement Contributions</h3>
                        <p class="strategy-description">Contributions to approved Retirement Annuities (RAs), pension, or provident funds are tax-deductible up to certain limits. Increasing these contributions can lower your taxable income.</p>
                    </div>
                </div>
                <div class="strategy-card card">
                    <div class="card-padding">
                        <h3 class="strategy-title">Utilise Medical Expense Deductions</h3>
                        <p class="strategy-description">Beyond the fixed medical scheme fees tax credit, you may claim additional tax credits for qualifying out-of-pocket medical expenses above a certain threshold, especially if you are over 65 or have a disability.</p>
                    </div>
                </div>
                <div class="strategy-card card">
                    <div class="card-padding">
                        <h3 class="strategy-title">Donate to Approved Charities</h3>
                        <p class="strategy-description">Donations made to Public Benefit Organisations (PBOs) approved by SARS are tax-deductible, up to a limit of 10% of your taxable income (before the donation deduction). Ensure you receive a Section 18A certificate.</p>
                    </div>
                </div>
                 <div class="strategy-card card">
                    <div class="card-padding">
                        <h3 class="strategy-title">Explore Tax-Free Savings Accounts (TFSAs)</h3>
                        <p class="strategy-description">While contributions are not tax-deductible, growth (interest, dividends, capital gains) within a TFSA is completely tax-free. Withdrawals are also tax-free. This is a powerful tool for long-term savings.</p>
                    </div>
                </div>
                 <div class="strategy-card card">
                    <div class="card-padding">
                        <h3 class="strategy-title">Understand Allowable Business Expenses (if applicable)</h3>
                        <p class="strategy-description">If you earn income from a trade (e.g., rental income, freelance work), ensure you claim all legitimate business expenses incurred in the production of that income. Keep accurate records.</p>
                    </div>
                </div>
                 <div class="strategy-card card">
                    <div class="card-padding">
                        <h3 class="strategy-title">Claim Travel Expenses (under specific conditions)</h3>
                        <p class="strategy-description">If you receive a travel allowance or use a company car and your duties require you to travel for work, you may be able to claim a deduction for business travel expenses. Detailed logbooks are essential.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="section faq-section">
        <div class="container">
            <h2 class="section-title">Frequently Asked Questions</h2>
            <p class="section-subtitle">Get answers to common questions about South African personal income tax.</p>
            <div id="faqContainer">
                <div class="faq-item">
                    <div class="faq-question">
                        What is the tax year in South Africa?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>The South African tax year runs from 1 March to the last day of February the following year. For example, the 2025/2026 tax year runs from 1 March 2025 to 28 February 2026.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        What are tax rebates?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Tax rebates are credits that reduce the amount of tax you need to pay. In South Africa, there are three types of rebates:</p>
                        <ul>
                            <li>Primary rebate: Available to all taxpayers</li>
                            <li>Secondary rebate: Additional credit for taxpayers aged 65 and over</li>
                            <li>Tertiary rebate: Additional credit for taxpayers aged 75 and over</li>
                        </ul>
                    </div>
                </div>
                 <div class="faq-item">
                    <div class="faq-question">
                        What is "take-home pay"?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Take-home pay, also known as net income, is the amount of money you receive after all deductions, primarily income tax, have been subtracted from your gross income. This calculator estimates your take-home pay after accounting for income tax, rebates, and medical credits.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        How are medical tax credits calculated?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Medical tax credits consist of two components:</p>
                        <ol>
                            <li>Medical Scheme Fees Tax Credit (MTC): A fixed monthly amount for the taxpayer and their dependents who are members of a medical scheme.</li>
                            <li>Additional Medical Expenses Tax Credit: A percentage of qualifying out-of-pocket medical expenses that weren't reimbursed by your medical aid.</li>
                        </ol>
                        <p>The calculation varies based on your age and whether you or any of your dependents have a disability.</p>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        What retirement contributions are tax-deductible?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>Contributions to pension funds, provident funds, and retirement annuities are tax-deductible, subject to certain limits. The deduction is limited to the lesser of:</p>
                        <ul>
                            <li>R350,000 per year, or</li>
                            <li>27.5% of the higher of your remuneration or taxable income, or</li>
                            <li>27.5% of your taxable income</li>
                        </ul>
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">
                        When is the deadline for tax returns in South Africa?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p>The deadlines for filing tax returns typically fall into these categories:</p>
                        <ul>
                            <li>Non-provisional taxpayers filing via eFiling: Usually late November/early December</li>
                            <li>Provisional taxpayers filing via eFiling: Usually end of January the following year</li>
                            <li>Manual/paper submissions: Usually earlier than electronic submissions</li>
                        </ul>
                        <p>SARS announces the exact dates each year, so it's important to check the official SARS website for the current year's filing season dates.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column about">
                    <a href="/" class="footer-logo">
                        <i class="fas fa-compass"></i> Financial<span>Compass</span>
                   </a>
                    <p class="footer-description">Your free guide to navigating South African personal finance. Empowering you with clear, accurate tools and insights.</p>
                    <div class="footer-social">
                        <a href="https://www.facebook.com/profile.php?id=61575624285316" class="footer-social-link" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://x.com/FinCompassSA" class="footer-social-link" aria-label="X (formerly Twitter)"><i class="fab fa-twitter"></i></a>
                        <a href="https://www.linkedin.com/company/107288558" class="footer-social-link" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <div class="footer-column links">
                    <h3 class="footer-heading">Quick Links</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="/">Home</a></li>
                        <li class="footer-link"><a href="/#tools">Financial Tools</a></li>
                        <li class="footer-link"><a href="/#about">Why Choose Us</a></li>
                        <li class="footer-link"><a href="/#updates">Latest Updates</a></li>
                         <li class="footer-link"><a href="/terms-privacy.html">Terms & Privacy</a></li>
                        </ul>
                </div>
                 <div class="footer-column calculators">
                    <h3 class="footer-heading">Calculators</h3>
                    <ul class="footer-links">
                        <li class="footer-link"><a href="/sars-tax-calculator.html">SARS Tax Calculator</a></li>
                        <li class="footer-link"><a href="/budget-planner.html">Budget Planner</a></li>
                        <li class="footer-link"><a href="/loan-calculators.html">Loan Calculators</a></li>
                        <li class="footer-link"><a href="/vat-calculator.html">VAT Calculator</a></li>
                        <li class="footer-link"><a href="/retirement-calculator.html">Retirement Calculator</a></li>
                        <li class="footer-link"><a href="/savings-goal-planner.html">Savings Goal Planner</a></li>
                    </ul>
                </div>
                 <div class="footer-column contact">
                    <h3 class="footer-heading">Disclaimer</h3>
                     <p class="footer-description" style="font-size: 0.85rem; color: rgba(255,255,255,0.5);">
                        Financial Compass provides tools for estimation purposes only. Information should not be considered financial advice. Always consult a qualified professional for financial decisions.
                    </p>
                    </div>
            </div> 
            <div class="footer-bottom">
                &copy; <span id="currentYear"></span> Financial Compass. Built for South Africans. All Rights Reserved.
            </div>
        </div>
    </footer>

    <script>
        // Tax Brackets and Constants
        const taxData = {
            "2025": {
                yearLabel: "2025/2026",
                brackets: [
                    { min: 0, max: 237100, rate: 18, base: 0 },
                    { min: 237101, max: 370500, rate: 26, base: 42678 },
                    { min: 370501, max: 512800, rate: 31, base: 77362 },
                    { min: 512801, max: 673000, rate: 36, base: 121475 },
                    { min: 673001, max: 857900, rate: 39, base: 179147 },
                    { min: 857901, max: 1817000, rate: 41, base: 251258 },
                    { min: 1817001, max: Infinity, rate: 45, base: 644489 }
                ],
                rebates: { primary: 17235, secondary: 9444, tertiary: 3145 },
                medicalCredits: { mainMember: 385, firstDependent: 385, additionalDependents: 262 },
                retirementLimit: 350000, retirementPercentage: 27.5
            },
            "2024": {
                yearLabel: "2024/2025",
                brackets: [
                    { min: 0, max: 226000, rate: 18, base: 0 },
                    { min: 226001, max: 353100, rate: 26, base: 40680 },
                    { min: 353101, max: 488700, rate: 31, base: 73726 },
                    { min: 488701, max: 641400, rate: 36, base: 115762 },
                    { min: 641401, max: 817600, rate: 39, base: 170734 },
                    { min: 817601, max: 1731600, rate: 41, base: 239452 },
                    { min: 1731601, max: Infinity, rate: 45, base: 614192 }
                ],
                rebates: { primary: 16425, secondary: 9000, tertiary: 2997 },
                medicalCredits: { mainMember: 367, firstDependent: 367, additionalDependents: 246 },
                retirementLimit: 350000, retirementPercentage: 27.5
            },
            "2023": {
                yearLabel: "2023/2024",
                brackets: [
                    { min: 0, max: 216200, rate: 18, base: 0 },
                    { min: 216201, max: 337800, rate: 26, base: 38916 },
                    { min: 337801, max: 467500, rate: 31, base: 70532 },
                    { min: 467501, max: 613600, rate: 36, base: 110739 },
                    { min: 613601, max: 782200, rate: 39, base: 163335 },
                    { min: 782201, max: 1656600, rate: 41, base: 229089 },
                    { min: 1656601, max: Infinity, rate: 45, base: 587593 }
                ],
                rebates: { primary: 15714, secondary: 8613, tertiary: 2871 },
                medicalCredits: { mainMember: 347, firstDependent: 347, additionalDependents: 234 },
                retirementLimit: 350000, retirementPercentage: 27.5
            }
        };

        // Global variables to store annual calculated values
        let currentAnnualGrossIncome = 0;
        let currentAnnualRetirementDeduction = 0;
        let currentAnnualTaxableIncome = 0;
        let currentAnnualIncomeTaxBeforeRebates = 0;
        let currentAnnualPrimaryRebate = 0;
        let currentAnnualAgeRebate = 0;
        let currentAnnualMedicalCredits = 0;
        let currentAnnualTaxPayable = 0;
        let currentAnnualTakeHomePay = 0;

        const wisdomNuggets = [
            "The best time to plant a tree was 20 years ago. The second best time is now. The same applies to your savings!",
            "Budgeting isn't about limiting yourself – it's about making your money go further.",
            "Small savings today can lead to big dreams tomorrow. Every rand counts!",
            "Understanding your taxes is the first step to financial empowerment.",
            "Invest in yourself. Your knowledge and skills are your greatest assets.",
            "Don't just work for money; make money work for you through wise investments.",
            "A financial plan is a roadmap to your goals. Start your journey today!"
        ];

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize DOM elements and event listeners
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const navMenu = document.getElementById('navMenu');
            const faqItems = document.querySelectorAll('.faq-item');
            const taxYearBtns = document.querySelectorAll('.tax-year-btn');
            const hasMedicalAid = document.getElementById('hasMedicalAid');
            const medicalAidSection = document.getElementById('medicalAidSection');
            const calculateBtn = document.getElementById('calculateBtn');
            const resetBtn = document.getElementById('resetBtn');
            const periodRadios = document.querySelectorAll('input[name="period"]');
            const incomePeriodRadios = document.querySelectorAll('input[name="incomePeriod"]');

            // Mobile Menu
            if (mobileMenuBtn) {
                mobileMenuBtn.addEventListener('click', function() {
                    const isExpanded = navMenu.classList.toggle('active');
                    mobileMenuBtn.setAttribute('aria-expanded', isExpanded);
                    mobileMenuBtn.innerHTML = isExpanded ? '<i class="fas fa-times"></i>' : '<i class="fas fa-bars"></i>';
                    document.body.classList.toggle('no-scroll', isExpanded);
                });
                 navMenu.querySelectorAll('a').forEach(link => {
                     link.addEventListener('click', () => {
                         if (navMenu.classList.contains('active')) {
                             navMenu.classList.remove('active');
                             mobileMenuBtn.setAttribute('aria-expanded', 'false');
                             mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
                             document.body.classList.remove('no-scroll');
                         }
                     });
                 });
            }

            // FAQ Accordion
            faqItems.forEach(item => {
                const question = item.querySelector('.faq-question');
                question.addEventListener('click', () => {
                    const currentlyActive = item.classList.contains('active');
                    faqItems.forEach(i => i.classList.remove('active'));
                    if (!currentlyActive) item.classList.add('active');
                });
            });

            // Tax Year Selector
            taxYearBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    taxYearBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const selectedYear = this.getAttribute('data-year');
                    updateTaxYearInfo(selectedYear);
                    if (document.getElementById('incomeInput').value) {
                        calculateTax(); // Recalculate if income is present
                    } else {
                         updateTaxBracketTable(0);
                         updateResultDisplay('annual'); // Reset display to annual with 0s
                    }
                });
            });
            
            // Medical Aid Section Toggle
            hasMedicalAid.addEventListener('change', function() {
                medicalAidSection.style.display = this.checked ? 'block' : 'none';
                 if (!this.checked) {
                     document.getElementById('medicalDependents').value = '1';
                     document.getElementById('monthlyMedicalContributions').value = '';
                     document.getElementById('annualMedicalExpenses').value = '';
                 }
            });

            // Calculate Button
            calculateBtn.addEventListener('click', calculateTax);

            // Reset Button
            resetBtn.addEventListener('click', function() {
                document.getElementById('taxCalculatorForm').reset();
                document.getElementById('ageSelect').value = 'under65';
                document.getElementById('incomePeriodMonthly').checked = true;
                updateIncomeInputLabel('monthly');
                medicalAidSection.style.display = 'none';
                
                // Reset all global annual values
                currentAnnualGrossIncome = 0;
                currentAnnualRetirementDeduction = 0;
                currentAnnualTaxableIncome = 0;
                currentAnnualIncomeTaxBeforeRebates = 0;
                currentAnnualPrimaryRebate = 0;
                currentAnnualAgeRebate = 0;
                currentAnnualMedicalCredits = 0;
                currentAnnualTaxPayable = 0;
                currentAnnualTakeHomePay = 0;

                document.getElementById('periodAnnual').checked = true; // Reset period toggle
                updateResultDisplay('annual'); // Update all displays with zeros
                updateTaxBracketTable(0);
                document.getElementById('wisdomNuggetOuterContainer').style.display = 'none';
            });

            // Result Period Toggle (Annual/Monthly for display)
            periodRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateResultDisplay(this.value);
                });
            });

            // Income Input Period Toggle (Annual/Monthly for input field)
            incomePeriodRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateIncomeInputLabel(this.value);
                });
            });

            // Initial page setup
            updateTaxYearInfo('2025');
            updateTaxBracketTable(0);
            updateResultDisplay('annual'); // Initialize display with 0s and annual labels
            document.getElementById('currentYear').textContent = new Date().getFullYear();
            updateIncomeInputLabel('monthly');
            updateActiveNavLink();
        });

        function updateActiveNavLink() {
            const navLinks = document.querySelectorAll('.nav-menu .nav-link');
            const currentPath = window.location.pathname;
            navLinks.forEach(link => {
                link.classList.remove('active');
                const linkHref = link.getAttribute('href');
                // More specific matching for tools link
                if ((currentPath.endsWith('sars-tax-calculator.html') || currentPath.endsWith('/#tools')) && linkHref === '/#tools') {
                    link.classList.add('active');
                } else if (currentPath.includes(linkHref.split('#')[0]) && linkHref.split('#')[0] !== '/' && linkHref !== '/#tools') {
                    link.classList.add('active');
                } else if ((currentPath === '/' || currentPath.endsWith('/index.html')) && linkHref === '/') {
                    link.classList.add('active');
                }
            });
        }


        function updateIncomeInputLabel(period) {
            const incomeTooltipTextEl = document.getElementById('incomeTooltipText');
            const incomeInputEl = document.getElementById('incomeInput');
            const ageTooltipTextEl = document.getElementById('ageTooltipText'); // Get age tooltip
            const selectedYear = document.querySelector('.tax-year-btn.active').getAttribute('data-year');
            const taxSettings = taxData[selectedYear];
            const yearEndDay = taxSettings.yearLabel === "2023/2024" ? "29 February" : "28 February";
            const yearEndYear = taxSettings.yearLabel.split('/')[1] || selectedYear;


            if (period === 'monthly') {
                incomeTooltipTextEl.textContent = 'Enter your total monthly income before any deductions';
                incomeInputEl.step = "100";
                incomeInputEl.placeholder = "e.g., 25000";
            } else {
                incomeTooltipTextEl.textContent = 'Enter your total annual income before any deductions';
                incomeInputEl.step = "1000";
                incomeInputEl.placeholder = "e.g., 300000";
            }
            // Update age tooltip text based on the currently selected tax year
            if (ageTooltipTextEl) {
                 ageTooltipTextEl.textContent = `Your age at the end of the tax year (${yearEndDay} ${yearEndYear})`;
            }
        }

        function updateTaxYearInfo(year) {
            const taxSettings = taxData[year];
            const yearEndDay = taxSettings.yearLabel === "2023/2024" ? "29 February" : "28 February";
            const yearEndYear = taxSettings.yearLabel.split('/')[1] || year;
            document.getElementById('taxYearInfoText').innerHTML = `The <strong>${taxSettings.yearLabel}</strong> tax year runs from 1 March ${parseInt(yearEndYear)-1} to ${yearEndDay} ${yearEndYear}. Key updates include a primary rebate of R${formatNumber(taxSettings.rebates.primary.toFixed(2))} and medical credits of R${taxSettings.medicalCredits.mainMember} per month for the main member.`;
            updateIncomeInputLabel(document.querySelector('input[name="incomePeriod"]:checked').value); // Update age tooltip via this
        }


        function updateTaxBracketTable(taxableIncome) {
            const selectedYear = document.querySelector('.tax-year-btn.active').getAttribute('data-year');
            const brackets = taxData[selectedYear].brackets;
            const tableBody = document.querySelector('#taxBracketTable tbody');
            tableBody.innerHTML = '';
            let userBracket = -1;

            for (let i = 0; i < brackets.length; i++) {
                if (taxableIncome >= brackets[i].min && (brackets[i].max === Infinity || taxableIncome <= brackets[i].max)) {
                    userBracket = i;
                    break;
                }
            }

            brackets.forEach((bracket, index) => {
                const row = document.createElement('tr');
                if (index === userBracket && taxableIncome > 0) { // Only highlight if income > 0
                    row.classList.add('tax-bracket-current');
                }
                const maxAmount = bracket.max === Infinity ? 'and above' : `- R${formatNumber(bracket.max.toFixed(2))}`;
                const minAmountFormatted = formatNumber(bracket.min.toFixed(2));
                row.innerHTML = `
                    <td>R${minAmountFormatted} ${maxAmount}</td>
                    <td>R${formatNumber(bracket.base.toFixed(2))} + ${bracket.rate}% of taxable income exceeding R${minAmountFormatted}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        async function calculateTax() {
            const calculateBtn = document.getElementById('calculateBtn');
            calculateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Calculating...';
            calculateBtn.disabled = true;
            await new Promise(resolve => setTimeout(resolve, 100));

            const selectedYear = document.querySelector('.tax-year-btn.active').getAttribute('data-year');
            const taxSettings = taxData[selectedYear];

            const age = document.getElementById('ageSelect').value;
            const incomeInputVal = parseFloat(document.getElementById('incomeInput').value) || 0;
            const incomePeriod = document.querySelector('input[name="incomePeriod"]:checked').value;
            currentAnnualGrossIncome = incomePeriod === 'monthly' ? incomeInputVal * 12 : incomeInputVal;

            const retirementContributionsInput = parseFloat(document.getElementById('retirementContributions').value) || 0;
            const hasMedicalAid = document.getElementById('hasMedicalAid').checked;
            const medicalDependents = parseInt(document.getElementById('medicalDependents').value) || 0;
            const monthlyMedicalContributions = parseFloat(document.getElementById('monthlyMedicalContributions').value) || 0;
            const annualMedicalExpenses = parseFloat(document.getElementById('annualMedicalExpenses').value) || 0;

            const maxRetirementDeductionPercentage = currentAnnualGrossIncome * (taxSettings.retirementPercentage / 100);
            currentAnnualRetirementDeduction = Math.min(retirementContributionsInput, taxSettings.retirementLimit, maxRetirementDeductionPercentage);
            currentAnnualTaxableIncome = Math.max(0, currentAnnualGrossIncome - currentAnnualRetirementDeduction);

            currentAnnualIncomeTaxBeforeRebates = 0;
            for (const bracket of taxSettings.brackets) {
                if (currentAnnualTaxableIncome >= bracket.min && (bracket.max === Infinity || currentAnnualTaxableIncome <= bracket.max)) {
                    currentAnnualIncomeTaxBeforeRebates = bracket.base + ((currentAnnualTaxableIncome - bracket.min + 0.00001) * bracket.rate / 100);
                    break;
                }
            }
            currentAnnualIncomeTaxBeforeRebates = Math.max(0, currentAnnualIncomeTaxBeforeRebates);

            currentAnnualPrimaryRebate = taxSettings.rebates.primary;
            currentAnnualAgeRebate = 0;
            if (age === '65to74') currentAnnualAgeRebate = taxSettings.rebates.secondary;
            else if (age === '75plus') currentAnnualAgeRebate = taxSettings.rebates.secondary + taxSettings.rebates.tertiary;
            const totalRebates = currentAnnualPrimaryRebate + currentAnnualAgeRebate;

            currentAnnualMedicalCredits = 0;
            if (hasMedicalAid && medicalDependents > 0) {
                let monthlyMTC = 0;
                if (medicalDependents >= 1) monthlyMTC += taxSettings.medicalCredits.mainMember;
                if (medicalDependents >= 2) monthlyMTC += taxSettings.medicalCredits.firstDependent;
                if (medicalDependents > 2) monthlyMTC += (medicalDependents - 2) * taxSettings.medicalCredits.additionalDependents;
                const annualMTC = monthlyMTC * 12;

                const annualMedicalContributionsTotal = monthlyMedicalContributions * 12;
                const totalPaidToSchemeAndOther = annualMedicalContributionsTotal + annualMedicalExpenses;
                let additionalMedicalCredit = 0;
                if (age === 'under65') {
                    const amountExceedingFourTimesMTC = totalPaidToSchemeAndOther - (4 * annualMTC);
                    const threshold = currentAnnualTaxableIncome * 0.075;
                    if (amountExceedingFourTimesMTC > threshold) {
                         additionalMedicalCredit = (amountExceedingFourTimesMTC - threshold) * 0.25;
                    }
                } else { 
                    const amountExceedingThreeTimesMTC = totalPaidToSchemeAndOther - (3 * annualMTC);
                     additionalMedicalCredit = amountExceedingThreeTimesMTC * (1/3);
                }
                currentAnnualMedicalCredits = annualMTC + Math.max(0, additionalMedicalCredit);
            }
            currentAnnualMedicalCredits = Math.max(0, currentAnnualMedicalCredits);

            const taxAfterRebates = Math.max(0, currentAnnualIncomeTaxBeforeRebates - totalRebates);
            currentAnnualTaxPayable = Math.max(0, taxAfterRebates - currentAnnualMedicalCredits);
            currentAnnualTakeHomePay = currentAnnualGrossIncome - currentAnnualTaxPayable;

            const selectedResultPeriod = document.querySelector('input[name="period"]:checked').value;
            updateResultDisplay(selectedResultPeriod); // This will update all display elements
            updateTaxBracketTable(currentAnnualTaxableIncome);
            displayWisdomNugget();

            calculateBtn.innerHTML = '<i class="fas fa-calculator"></i> Calculate Tax';
            calculateBtn.disabled = false;
        }

        function updateResultDisplay(period) {
            const isMonthly = period === 'monthly';
            const divisor = isMonthly ? 12 : 1;
            const periodLabelSuffix = isMonthly ? '(Monthly)' : '(Annual)';

            // Update main summary boxes
            document.getElementById('totalTaxResult').textContent = `R${formatNumber((currentAnnualTaxPayable / divisor).toFixed(2))}`;
            document.getElementById('resultPeriodLabel').textContent = `Estimated Tax Liability ${periodLabelSuffix}`;
            document.getElementById('totalTakeHomeResult').textContent = `R${formatNumber((currentAnnualTakeHomePay / divisor).toFixed(2))}`;
            document.getElementById('takeHomePeriodLabel').textContent = `Estimated Take-Home Pay ${periodLabelSuffix}`;

            // Update detailed breakdown labels and values
            document.getElementById('grossIncomeLabel').textContent = `Gross Income ${periodLabelSuffix}:`;
            document.getElementById('grossIncomeResult').textContent = `R${formatNumber((currentAnnualGrossIncome / divisor).toFixed(2))}`;

            document.getElementById('retirementDeductionLabel').textContent = `Retirement Deduction ${periodLabelSuffix}:`;
            document.getElementById('retirementDeductionResult').textContent = `R${formatNumber((currentAnnualRetirementDeduction / divisor).toFixed(2))}`;
            
            document.getElementById('taxableIncomeLabel').textContent = `Taxable Income ${periodLabelSuffix}:`;
            document.getElementById('taxableIncomeResult').textContent = `R${formatNumber((currentAnnualTaxableIncome / divisor).toFixed(2))}`;

            document.getElementById('incomeTaxLabel').textContent = `Income Tax (before rebates, ${periodLabelSuffix.toLowerCase()}):`;
            document.getElementById('incomeTaxResult').textContent = `R${formatNumber((currentAnnualIncomeTaxBeforeRebates / divisor).toFixed(2))}`;
            
            document.getElementById('primaryRebateLabel').textContent = `Primary Rebate ${periodLabelSuffix}:`;
            document.getElementById('primaryRebateResult').textContent = `R${formatNumber((currentAnnualPrimaryRebate / divisor).toFixed(2))}`;

            document.getElementById('ageRebateLabel').textContent = `Age Rebate ${periodLabelSuffix}:`;
            document.getElementById('ageRebateResult').textContent = `R${formatNumber((currentAnnualAgeRebate / divisor).toFixed(2))}`;

            document.getElementById('medicalCreditsLabel').textContent = `Medical Credits ${periodLabelSuffix}:`;
            document.getElementById('medicalCreditsResult').textContent = `R${formatNumber((currentAnnualMedicalCredits / divisor).toFixed(2))}`;

            document.getElementById('taxPayableDetailLabel').textContent = `Net Tax Payable ${periodLabelSuffix}:`;
            document.getElementById('taxPayableResult').textContent = `R${formatNumber((currentAnnualTaxPayable / divisor).toFixed(2))}`;
            
            document.getElementById('takeHomePayDetailLabel').textContent = `Net Take-Home Pay ${periodLabelSuffix}:`;
            document.getElementById('takeHomePayResult').textContent = `R${formatNumber((currentAnnualTakeHomePay / divisor).toFixed(2))}`;

            // Update Income Journey Chart
            updateIncomeJourneyChart(
                currentAnnualGrossIncome / divisor,
                currentAnnualRetirementDeduction / divisor,
                currentAnnualMedicalCredits / divisor, // Note: Medical credits are part of tax payable, chart shows RA, Tax, TakeHome
                currentAnnualTaxPayable / divisor,
                currentAnnualTakeHomePay / divisor,
                period
            );
        }


        function updateIncomeJourneyChart(gross, retirement, medicalCreditsVal, tax, takeHome, period) {
            if (window.incomeJourneyChartInstance) {
                window.incomeJourneyChartInstance.destroy();
            }
            const ctx = document.getElementById('incomeJourneyChart').getContext('2d');
            const displayGross = Math.max(0, gross);
            const displayRetirement = Math.max(0, retirement);
            const displayTax = Math.max(0, tax);
            const displayTakeHome = Math.max(0, takeHome);
            
            // Check if all input values for the chart are zero (initial state or reset)
            // The chart shows Retirement, Tax, TakeHome. Gross is in the title.
            const chartDataAllZero = displayRetirement === 0 && displayTax === 0 && displayTakeHome === 0;
            const periodLabelSuffix = period === 'monthly' ? 'Monthly' : 'Annual';
            document.getElementById('incomeJourneyChartTitle').textContent = `Your Income Journey (${periodLabelSuffix})`;


            const data = {
                labels: chartDataAllZero ? [`Enter details to see your ${periodLabelSuffix.toLowerCase()} income journey`] : ['Retirement Contributions', 'Total Tax Payable', 'Net Take-Home Pay'],
                datasets: [{
                    label: 'Income Journey',
                    data: chartDataAllZero ? [1] : [displayRetirement, displayTax, displayTakeHome],
                    backgroundColor: chartDataAllZero ? ['#E9ECEF'] : ['#FFC107', '#dc3545', '#28a745'],
                    borderColor: '#FFFFFF',
                    borderWidth: 2,
                    hoverOffset: 4
                }]
            };

            window.incomeJourneyChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, font: { size: 11 }}},
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    if (chartDataAllZero && displayGross === 0) return context.label; // Show placeholder text if gross is also 0
                                    let label = context.dataset.data.length > 1 ? (context.label || '') : ''; // Avoid label for placeholder
                                    if (label) label += ': ';
                                     // Ensure context.raw is a number before calling toFixed
                                    const value = parseFloat(context.raw);
                                    if (!isNaN(value)) {
                                        label += `R${formatNumber(value.toFixed(2))}`;
                                    } else if (chartDataAllZero && displayGross === 0) { // If it's the placeholder single slice
                                        return context.label;
                                    }
                                    return label;
                                }
                            }
                        },
                        title: { // Chart title showing Gross Income
                            display: !(chartDataAllZero && displayGross === 0), // Only display if there's actual data
                            text: `Gross ${periodLabelSuffix} Income: R${formatNumber(displayGross.toFixed(2))}`,
                            padding: { top: 10, bottom: 20 },
                            font: { size: 14, weight: 'bold' }
                        }
                    },
                    animation: { animateScale: true, animateRotate: true }
                }
            });
        }

        function displayWisdomNugget() {
            const nuggetOuterContainer = document.getElementById('wisdomNuggetOuterContainer');
            const nuggetTextElement = document.getElementById('wisdomNuggetText');
            const randomIndex = Math.floor(Math.random() * wisdomNuggets.length);
            nuggetTextElement.textContent = wisdomNuggets[randomIndex];
            nuggetOuterContainer.style.display = 'block';
        }

        function formatNumber(numberStr) {
            const num = parseFloat(numberStr);
            if (isNaN(num)) return numberStr;
            return num.toLocaleString('en-ZA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
    </script>
</body>
</html>
